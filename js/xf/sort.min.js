((e,f)=>{XF.ListSorter=XF.Element.newHandler({options:{dragParent:null,dragHandle:null,undraggable:".is-undraggable",direction:"vertical",submitOnDrop:!1},drake:null,init(){if(this.options.dragParent)XF.on(e,"listSorterDuplication",this.drakeSetup.bind(this));XF.onDelegated(this.target,"touchmove",this.options.dragHandle,a=>a.preventDefault());this.drakeSetup()},drakeSetup(){this.drake&&this.drake.destroy();const a=this.options.dragParent?this.target.querySelector(this.options.dragParent):[this.target];
this.drake=dragula(a,{moves:this.isMoveable.bind(this),accepts:this.isValidTarget.bind(this),direction:this.options.direction});if(this.options.submitOnDrop){const c=a.closest("form");if(c)this.drake.on("drop",d=>{XF.trigger(c,"submit")&&c.submit()})}},isMoveable(a,c,d,b){c=this.options.dragHandle;b=this.options.undraggable;return c&&!d.closest(c)||b&&a.closest(b)?!1:!0},isValidTarget(a,c,d,b){for(a=b?b.previousElementSibling:Array.from(this.target.children).slice(-1)[0];a;){if(a.classList.contains("js-blockDragafter"))return!1;
a=a.previousElementSibling}if(b)for(;b;){if(b.classList.contains("js-blockDragbefore"))return!1;b=b.nextElementSibling}return!0}});XF.Element.register("list-sorter","XF.ListSorter")})(window,document);
