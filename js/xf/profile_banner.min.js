((h,q)=>{XF.BannerUpload=XF.Element.newHandler({options:{},init(){const a=this.target,b=a.querySelector(".js-uploadBanner"),c=a.querySelector(".js-deleteBanner"),e=a.querySelector(".js-banner");e&&(e.closest(".profileBannerContainer").classList.contains("profileBannerContainer--withBanner")?c.classList.remove("is-hidden"):c.classList.add("is-hidden"));XF.on(b,"change",this.changeFile.bind(this));XF.on(a,"ajax-submit:response",this.ajaxResponse.bind(this))},changeFile(a){""!==a.target.value&&XF.trigger(this.target,
"submit")},ajaxResponse(a){const {data:b}=a;if(!b.errors&&!b.exception){a.preventDefault();b.message&&XF.flashMessage(b.message,3E3);var c=this.target;a=c.querySelector(".js-deleteBanner");var e=c.querySelector(".js-uploadBanner"),f;(c=c.querySelector(".js-banner"))&&(f=c.closest(".profileBannerContainer"));var k=b.banners,n=b.position;c=Object.keys(k).length;var l="memberProfileBanner-u"+b.userId+"-";e.value="";q.querySelectorAll(".memberProfileBanner").forEach(d=>{const p=d.parentNode,r=d.dataset.hideEmpty,
m=d.dataset.toggleClass;let g;d.matches(`[class*="${l}"]`)&&(d.classList.contains(l+"m")?g=k.m:d.classList.contains(l+"l")?g=k.l:d.classList.contains(l+"o")&&(g=k.o));d.style.backgroundImage=g?`url(${g})`:"none";d.style.backgroundPositionY=null!==n?`${n}%`:null;r&&(g?d.classList.remove("memberProfileBanner--empty"):d.classList.add("memberProfileBanner--empty"));XF.trigger(d,"profile-banner:refresh");m&&(g?p.classList.add(m):p.classList.remove(m))});c?(a.classList.remove("is-hidden"),f&&f.classList.add("profileBannerContainer--withBanner")):
(a.classList.add("is-hidden"),f&&f.classList.remove("profileBannerContainer--withBanner"))}}});XF.BannerPositioner=XF.Element.newHandler({options:{},banner:null,value:null,y:0,ns:"bannerPositioner",dragging:!1,scaleFactor:1,init(){const a=this.target;this.banner=a;a.style.touchAction="none";a.style.cursor="move";this.value=a.querySelector(".js-bannerPosY");this.initDragging();XF.on(a,"profile-banner:refresh",()=>{const b=a.style.backgroundPositionY;b&&(this.value.value=parseFloat(b));this.stopDragging();
XF.off(a,"."+this.ns);this.initDragging()})},initDragging(){const a=this.ns,b=this.banner;let c=b.style.backgroundImage;const e=new Image;(c=c.replace(/^url\(["']?(.*?)["']?\)$/i,"$1"))&&"none"!==c&&(e.onload=()=>{const f=()=>{this.scaleFactor=1/(e.height*(e.width?b.clientWidth/e.width:1)/100);XF.on(b,`mousedown.${a}`,this.dragStart.bind(this));XF.on(b,`touchstart.${a}`,this.dragStart.bind(this))};0<b.clientWidth?f():(XF.on(b,"mouseover."+a,f),XF.on(b,"touchstart."+a,f,{passive:!0}))},e.src=XF.canonicalizeUrl(c))},
dragStart(a){a.preventDefault();const b=this.ns;if(a.touches)this.y=a.touches[0].clientY;else if(this.y=a.clientY,0<a.button)return;this.dragging=!0;XF.on(h,"mousemove."+b,this.dragMove.bind(this));XF.on(h,"touchmove."+b,this.dragMove.bind(this));XF.on(h,"mouseup."+b,this.dragEnd.bind(this));XF.on(h,"touchend."+b,this.dragEnd.bind(this),{passive:!0})},dragMove(a){if(this.dragging){a.preventDefault();var b=parseFloat(this.banner.style.backgroundPositionY);a=a.touches?a.touches[0].clientY:a.clientY;
b+=(this.y-a)*this.scaleFactor;b=Math.min(Math.max(0,b),100);this.banner.style.backgroundPositionY=`${b}%`;this.value.value=b;this.y=a}},dragEnd(a){this.stopDragging()},stopDragging(){this.dragging&&(XF.off(h,`.${this.ns}`),this.y=0,this.dragging=!1)}});XF.Element.register("banner-upload","XF.BannerUpload");XF.Element.register("banner-positioner","XF.BannerPositioner")})(window,document);
