((g,e)=>{XF.CropBox=XF.create({options:{},target:null,frame:null,width:null,height:null,imageWidth:null,imageHeight:null,imageLeft:0,imageTop:0,percent:0,percentMin:null,onload:null,__construct(a,b,c){this.target=a;this.options=XF.extendObject(!0,{},this.options,b);this.target.draggable=!1;this.target.classList.add("cropImage");this.frame=XF.createElement("div",{className:"cropFrame"});a.parentNode.insertBefore(this.frame,a);this.frame.appendChild(a);this.onload=c||(()=>{});this.init()},init(){this.updateOptions();
let a=null;XF.on(this.target,"pointerdown.cropbox",b=>{a||(a={initialX:b.pageX,initialY:b.pageY,startX:this.imageLeft,startY:this.imageTop,dx:0,dy:0},b.preventDefault())});XF.on(e,"pointermove.cropbox",b=>{a&&(a.dx=b.pageX-a.initialX,a.dy=b.pageY-a.initialY,this.drag({startX:a.startX,startY:a.startY,dx:a.dx,dy:a.dy},!0))});XF.on(e,"pointerup.cropbox",()=>{a&&(this.update(),a=null)});XF.on(this.target,"wheel.cropbox",b=>{b.preventDefault();0>b.deltaY?this.zoomIn():this.zoomOut()})},updateOptions(){this.imageLeft=
this.imageTop=0;this.target.style.width="";this.target.left=this.imageLeft+"px";this.target.top=this.imageTop+"px";this.frame.style.width=this.options.width+"px";this.frame.style.height=this.options.height+"px";XF.off(this.frame,".cropbox");this.frame.classList.remove("hover");const a=new Image;a.onload=()=>{this.width=a.width;this.height=a.height;a.src="";a.onload=null;this.percent=0;this.fit();this.options.result?this.setCrop(this.options.result):this.zoom(this.minPercent);XF.Animate.fadeIn(this.target,
{speed:500});this.onload(this)};a.src=this.target.getAttribute("src")},remove(){XF.off(this.frame,".cropbox");XF.off(this.target,".cropbox");this.target.style.width="";this.target.style.left="";this.target.style.top="";this.target.classList.remove("cropImage");this.target.removeAttribute("data-cropbox");this.frame.after(this.target);this.frame.classList.remove("cropFrame");for(this.frame.removeAttribute("style");this.frame.firstChild;)this.frame.removeChild(this.frame.firstChild);this.frame.parentNode.removeChild(this.frame)},
fit(){const a=this.options.width/this.width,b=this.options.height/this.height;this.minPercent=a>=b?a:b},setCrop(a){this.percent=Math.max(this.options.width/a.cropW,this.options.height/a.cropH);this.imageWidth=Math.ceil(this.width*this.percent);this.imageHeight=Math.ceil(this.height*this.percent);this.imageLeft=-Math.floor(a.cropX*this.percent);this.imageTop=-Math.floor(a.cropY*this.percent);this.target.style.width=this.imageWidth+"px";this.target.style.left=this.imageLeft+"px";this.target.style.top=
this.imageTop+"px";this.update()},zoom(a){const b=this.percent;this.percent=Math.max(this.minPercent,Math.min(this.options.maxZoom,a));this.imageWidth=Math.ceil(this.width*this.percent);this.imageHeight=Math.ceil(this.height*this.percent);b?(a=this.percent/b,this.imageLeft=this.fill((1-a)*this.options.width/2+a*this.imageLeft,this.imageWidth,this.options.width),this.imageTop=this.fill((1-a)*this.options.height/2+a*this.imageTop,this.imageHeight,this.options.height)):(this.imageLeft=this.fill((this.options.width-
this.imageWidth)/2,this.imageWidth,this.options.width),this.imageTop=this.fill((this.options.height-this.imageHeight)/2,this.imageHeight,this.options.height));this.target.style.width=this.imageWidth+"px";this.target.style.left=this.imageLeft+"px";this.target.style.top=this.imageTop+"px";this.update()},zoomIn(){this.zoom(this.percent+(1-this.minPercent)/(this.options.zoom-1||1))},zoomOut(){this.zoom(this.percent-(1-this.minPercent)/(this.options.zoom-1||1))},drag(a,b){this.imageLeft=this.fill(a.startX+
a.dx,this.imageWidth,this.options.width);this.imageTop=this.fill(a.startY+a.dy,this.imageHeight,this.options.height);this.target.style.left=this.imageLeft+"px";this.target.style.top=this.imageTop+"px";b||this.update()},update(){this.result={cropX:-Math.ceil(this.imageLeft/this.percent),cropY:-Math.ceil(this.imageTop/this.percent),cropW:Math.floor(this.options.width/this.percent),cropH:Math.floor(this.options.height/this.percent),stretch:1<this.minPercent};XF.trigger(this.target,XF.customEvent("cropbox",
{results:this.result,cropbox:this}))},getDataURL(){const a=e.createElement("canvas"),b=a.getContext("2d");a.width=this.options.width;a.height=this.options.height;b.drawImage(this.target,this.result.cropX,this.result.cropY,this.result.cropW,this.result.cropH,0,0,this.options.width,this.options.height);return a.toDataURL()},getBlob(){return this.uri2Blob(this.getDataURL())},uri2Blob(a){var b=a.split(",");a=atob(b[1]);b=b[0].split(":")[1].split(";")[0];const c=new ArrayBuffer(a.length),f=new Uint8Array(c);
for(let d=0;d<a.length;d++)f[d]=a.charCodeAt(d);return new Blob([c],{type:b})},fill(a,b,c){a+b<c&&(a=c-b);return 0<a?0:a}})})(window,document);
