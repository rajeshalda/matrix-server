/*! @flowjs/flow.js 2.14.1 */
!function(a,b,c){"use strict";function d(b){if(this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.slice&&!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice),this.support){this.supportDirectory=/Chrome/.test(a.navigator.userAgent)||/Firefox/.test(a.navigator.userAgent)||/Edge/.test(a.navigator.userAgent),this.files=[],this.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:.1,query:{},headers:{},withCredentials:!1,preprocess:null,changeRawDataBeforeSend:null,method:"multipart",testMethod:"GET",uploadMethod:"POST",prioritizeFirstAndLastChunk:!1,allowDuplicateUploads:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,413,415,500,501],successStatuses:[200,201,202],onDropStopPropagation:!1,initFileFn:null,readFileFn:f},this.opts={},this.events={};var c=this;this.onDrop=function(a){c.opts.onDropStopPropagation&&a.stopPropagation(),a.preventDefault();var b=a.dataTransfer;b.items&&b.items[0]&&b.items[0].webkitGetAsEntry?c.webkitReadDataTransfer(a):c.addFiles(b.files,a)},this.preventEvent=function(a){a.preventDefault()},this.opts=d.extend({},this.defaults,b||{})}}function e(a,b,d){this.flowObj=a,this.bytes=null,this.file=b,this.name=b.fileName||b.name,this.size=b.size,this.relativePath=b.relativePath||b.webkitRelativePath||this.name,this.uniqueIdentifier=d===c?a.generateUniqueIdentifier(b):d,this.chunkSize=0,this.chunks=[],this.paused=!1,this.error=!1,this.averageSpeed=0,this.currentSpeed=0,this._lastProgressCallback=Date.now(),this._prevUploadedSize=0,this._prevProgress=0,this.bootstrap()}function f(a,b,c,d,e){var f="slice";a.file.slice?f="slice":a.file.mozSlice?f="mozSlice":a.file.webkitSlice&&(f="webkitSlice"),e.readFinished(a.file[f](b,c,d))}function g(a,b,c){this.flowObj=a,this.fileObj=b,this.offset=c,this.tested=!1,this.retries=0,this.pendingRetry=!1,this.preprocessState=0,this.readState=0,this.loaded=0,this.total=0,this.chunkSize=this.fileObj.chunkSize,this.startByte=this.offset*this.chunkSize,this.filename=null,this.computeEndByte=function(){var a=Math.min(this.fileObj.size,(this.offset+1)*this.chunkSize);return this.fileObj.size-a<this.chunkSize&&!this.flowObj.opts.forceChunkSize&&(a=this.fileObj.size),a},this.endByte=this.computeEndByte(),this.xhr=null;var d=this;this.event=function(a,b){b=Array.prototype.slice.call(arguments),b.unshift(d),d.fileObj.chunkEvent.apply(d.fileObj,b)},this.progressHandler=function(a){a.lengthComputable&&(d.loaded=a.loaded,d.total=a.total),d.event("progress",a)},this.testHandler=function(a){var b=d.status(!0);"error"===b?(d.event(b,d.message()),d.flowObj.uploadNextChunk()):"success"===b?(d.tested=!0,d.event(b,d.message()),d.flowObj.uploadNextChunk()):d.fileObj.paused||(d.tested=!0,d.send())},this.doneHandler=function(a){var b=d.status();if("success"===b||"error"===b)delete this.data,d.event(b,d.message()),d.flowObj.uploadNextChunk();else if(!d.fileObj.paused){d.event("retry",d.message()),d.pendingRetry=!0,d.abort(),d.retries++;var c=d.flowObj.opts.chunkRetryInterval;null!==c?setTimeout(function(){d.send()},c):d.send()}}}function h(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}function i(a,b){return"function"==typeof a&&(b=Array.prototype.slice.call(arguments),a=a.apply(null,b.slice(1))),a}function j(a,b){setTimeout(a.bind(b),0)}function k(a,b){return l(arguments,function(b){b!==a&&l(b,function(b,c){a[c]=b})}),a}function l(a,b,c){if(a){var d;if("undefined"!=typeof a.length){for(d=0;d<a.length;d++)if(b.call(c,a[d],d)===!1)return}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d)===!1)return}}if(!a||!b)return void console.warn("Flowjs needs window and document objects to work");var m=a.navigator.msPointerEnabled;d.prototype={on:function(a,b){a=a.toLowerCase(),this.events.hasOwnProperty(a)||(this.events[a]=[]),this.events[a].push(b)},off:function(a,b){a!==c?(a=a.toLowerCase(),b!==c?this.events.hasOwnProperty(a)&&h(this.events[a],b):delete this.events[a]):this.events={}},fire:function(a,b){b=Array.prototype.slice.call(arguments),a=a.toLowerCase();var c=!1;return this.events.hasOwnProperty(a)&&l(this.events[a],function(a){c=a.apply(this,b.slice(1))===!1||c},this),"catchall"!=a&&(b.unshift("catchAll"),c=this.fire.apply(this,b)===!1||c),!c},webkitReadDataTransfer:function(a){function b(a){a.readEntries(function(f){f.length?(g+=f.length,l(f,function(a){if(a.isFile){var e=a.fullPath;a.file(function(a){c(a,e)},d)}else a.isDirectory&&b(a.createReader())}),b(a)):e()},d)}function c(a,b){a.relativePath=b.substring(1),h.push(a),e()}function d(a){throw e(),a}function e(){0==--g&&f.addFiles(h,a)}var f=this,g=a.dataTransfer.items.length,h=[];l(a.dataTransfer.items,function(a){var d=a.webkitGetAsEntry();return d?void(d.isFile?c(a.getAsFile(),d.fullPath):b(d.createReader())):void e()})},generateUniqueIdentifier:function(a){var b=this.opts.generateUniqueIdentifier;if("function"==typeof b)return b(a);var c=a.relativePath||a.webkitRelativePath||a.fileName||a.name;return a.size+"-"+c.replace(/[^0-9a-zA-Z_-]/gim,"")},uploadNextChunk:function(a){var b=!1;if(this.opts.prioritizeFirstAndLastChunk&&(l(this.files,function(a){return!a.paused&&a.chunks.length&&"pending"===a.chunks[0].status()?(a.chunks[0].send(),b=!0,!1):!a.paused&&a.chunks.length>1&&"pending"===a.chunks[a.chunks.length-1].status()?(a.chunks[a.chunks.length-1].send(),b=!0,!1):void 0}),b))return b;if(l(this.files,function(a){if(a.paused||l(a.chunks,function(a){if("pending"===a.status())return a.send(),b=!0,!1}),b)return!1}),b)return!0;var c=!1;return l(this.files,function(a){if(!a.isComplete())return c=!0,!1}),c||a||j(function(){this.fire("complete")},this),!1},assignBrowse:function(a,c,d,e){a instanceof Element&&(a=[a]),l(a,function(a){var f;"INPUT"===a.tagName&&"file"===a.type?f=a:(f=b.createElement("input"),f.setAttribute("type","file"),k(f.style,{visibility:"hidden",position:"absolute",width:"1px",height:"1px"}),a.appendChild(f),a.addEventListener("click",function(){f.click()},!1)),this.opts.singleFile||d||f.setAttribute("multiple","multiple"),c&&f.setAttribute("webkitdirectory","webkitdirectory"),l(e,function(a,b){f.setAttribute(b,a)});var g=this;f.addEventListener("change",function(a){a.target.value&&(g.addFiles(a.target.files,a),a.target.value="")},!1)},this)},assignDrop:function(a){"undefined"==typeof a.length&&(a=[a]),l(a,function(a){a.addEventListener("dragover",this.preventEvent,!1),a.addEventListener("dragenter",this.preventEvent,!1),a.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(a){"undefined"==typeof a.length&&(a=[a]),l(a,function(a){a.removeEventListener("dragover",this.preventEvent),a.removeEventListener("dragenter",this.preventEvent),a.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var a=!1;return l(this.files,function(b){if(b.isUploading())return a=!0,!1}),a},_shouldUploadNext:function(){var a=0,b=!0,c=this.opts.simultaneousUploads;return l(this.files,function(d){l(d.chunks,function(d){if("uploading"===d.status()&&(a++,a>=c))return b=!1,!1})}),b&&a},upload:function(){var a=this._shouldUploadNext();if(a!==!1){this.fire("uploadStart");for(var b=!1,c=1;c<=this.opts.simultaneousUploads-a;c++)b=this.uploadNextChunk(!0)||b;b||j(function(){this.fire("complete")},this)}},resume:function(){l(this.files,function(a){a.isComplete()||a.resume()})},pause:function(){l(this.files,function(a){a.pause()})},cancel:function(){for(var a=this.files.length-1;a>=0;a--)this.files[a].cancel()},progress:function(){var a=0,b=0;return l(this.files,function(c){a+=c.progress()*c.size,b+=c.size}),b>0?a/b:0},addFile:function(a,b){this.addFiles([a],b)},addFiles:function(a,b){var c=[];l(a,function(a){if((!m||m&&a.size>0)&&(a.size%4096!==0||"."!==a.name&&"."!==a.fileName)){var d=this.generateUniqueIdentifier(a);if(this.opts.allowDuplicateUploads||!this.getFromUniqueIdentifier(d)){var f=new e(this,a,d);this.fire("fileAdded",f,b)&&c.push(f)}}},this),this.fire("filesAdded",c,b)&&(l(c,function(a){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(a)},this),this.fire("filesSubmitted",c,b))},removeFile:function(a){for(var b=this.files.length-1;b>=0;b--)this.files[b]===a&&(this.files.splice(b,1),a.abort(),this.fire("fileRemoved",a))},getFromUniqueIdentifier:function(a){var b=!1;return l(this.files,function(c){c.uniqueIdentifier===a&&(b=c)}),b},getSize:function(){var a=0;return l(this.files,function(b){a+=b.size}),a},sizeUploaded:function(){var a=0;return l(this.files,function(b){a+=b.sizeUploaded()}),a},timeRemaining:function(){var a=0,b=0;return l(this.files,function(c){c.paused||c.error||(a+=c.size-c.sizeUploaded(),b+=c.averageSpeed)}),a&&!b?Number.POSITIVE_INFINITY:a||b?Math.floor(a/b):0}},e.prototype={measureSpeed:function(){var a=Date.now()-this._lastProgressCallback;if(a){var b=this.flowObj.opts.speedSmoothingFactor,c=this.sizeUploaded();this.currentSpeed=Math.max((c-this._prevUploadedSize)/a*1e3,0),this.averageSpeed=b*this.currentSpeed+(1-b)*this.averageSpeed,this._prevUploadedSize=c}},chunkEvent:function(a,b,c){switch(b){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval)break;this.measureSpeed(),this.flowObj.fire("fileProgress",this,a),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now();break;case"error":this.error=!0,this.abort(!0),this.flowObj.fire("fileError",this,c,a),this.flowObj.fire("error",c,this,a);break;case"success":if(this.error)return;this.measureSpeed(),this.flowObj.fire("fileProgress",this,a),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now(),this.isComplete()&&(this.currentSpeed=0,this.averageSpeed=0,this.flowObj.fire("fileSuccess",this,c,a));break;case"retry":this.flowObj.fire("fileRetry",this,a)}},pause:function(){this.paused=!0,this.abort()},resume:function(){this.paused=!1,this.flowObj.upload()},abort:function(a){this.currentSpeed=0,this.averageSpeed=0;var b=this.chunks;a&&(this.chunks=[]),l(b,function(a){"uploading"===a.status()&&(a.abort(),this.flowObj.uploadNextChunk())},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){"function"==typeof this.flowObj.opts.initFileFn&&this.flowObj.opts.initFileFn(this),this.abort(!0),this.error=!1,this._prevProgress=0;var a=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor;this.chunkSize=i(this.flowObj.opts.chunkSize,this);for(var b=Math.max(a(this.size/this.chunkSize),1),c=0;c<b;c++)this.chunks.push(new g(this.flowObj,this,c))},progress:function(){if(this.error)return 1;if(1===this.chunks.length)return this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress()),this._prevProgress;var a=0;l(this.chunks,function(b){a+=b.progress()*(b.endByte-b.startByte)});var b=a/this.size;return this._prevProgress=Math.max(this._prevProgress,b>.9999?1:b),this._prevProgress},isUploading:function(){var a=!1;return l(this.chunks,function(b){if("uploading"===b.status())return a=!0,!1}),a},isComplete:function(){var a=!1;return l(this.chunks,function(b){var c=b.status();if("pending"===c||"uploading"===c||"reading"===c||1===b.preprocessState||1===b.readState)return a=!0,!1}),!a},sizeUploaded:function(){var a=0;return l(this.chunks,function(b){a+=b.sizeUploaded()}),a},timeRemaining:function(){if(this.paused||this.error)return 0;var a=this.size-this.sizeUploaded();return a&&!this.averageSpeed?Number.POSITIVE_INFINITY:a||this.averageSpeed?Math.floor(a/this.averageSpeed):0},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}},g.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObj.size,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(a,b){return 0==b.length?a:(a+=a.indexOf("?")<0?"?":"&",a+b.join("&"))},test:function(){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.testHandler,!1),this.xhr.addEventListener("error",this.testHandler,!1);var a=i(this.flowObj.opts.testMethod,this.fileObj,this),b=this.prepareXhrRequest(a,!0);this.xhr.send(b)},preprocessFinished:function(){this.endByte=this.computeEndByte(),this.preprocessState=2,this.send()},readFinished:function(a){this.readState=2,this.bytes=a,this.send()},send:function(){var a=this.flowObj.opts.preprocess,b=this.flowObj.opts.readFileFn;if("function"==typeof a)switch(this.preprocessState){case 0:return this.preprocessState=1,void a(this);case 1:return}switch(this.readState){case 0:return this.readState=1,void b(this.fileObj,this.startByte,this.endByte,this.fileObj.file.type,this);case 1:return}if(this.flowObj.opts.testChunks&&!this.tested)return void this.test();this.loaded=0,this.total=0,this.pendingRetry=!1,this.xhr=new XMLHttpRequest,this.xhr.upload.addEventListener("progress",this.progressHandler,!1),this.xhr.addEventListener("load",this.doneHandler,!1),this.xhr.addEventListener("error",this.doneHandler,!1);var c=i(this.flowObj.opts.uploadMethod,this.fileObj,this),d=this.prepareXhrRequest(c,!1,this.flowObj.opts.method,this.bytes),e=this.flowObj.opts.changeRawDataBeforeSend;"function"==typeof e&&(d=e(this,d)),this.xhr.send(d)},abort:function(){var a=this.xhr;this.xhr=null,a&&a.abort()},status:function(a){return 1===this.readState?"reading":this.pendingRetry||1===this.preprocessState?"uploading":this.xhr?this.xhr.readyState<4?"uploading":this.flowObj.opts.successStatuses.indexOf(this.xhr.status)>-1?"success":this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||!a&&this.retries>=this.flowObj.opts.maxChunkRetries?"error":(this.abort(),"pending"):"pending"},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry)return 0;var a=this.status();return"success"===a||"error"===a?1:"pending"===a?0:this.total>0?this.loaded/this.total:0},sizeUploaded:function(){var a=this.endByte-this.startByte;return"success"!==this.status()&&(a=this.progress()*a),a},prepareXhrRequest:function(a,b,c,d){var e=i(this.flowObj.opts.query,this.fileObj,this,b);e=k(e||{},this.getParams());var f=i(this.flowObj.opts.target,this.fileObj,this,b),g=null;if("GET"===a||"octet"===c){var h=[];l(e,function(a,b){h.push([encodeURIComponent(b),encodeURIComponent(a)].join("="))}),f=this.getTarget(f,h),g=d||null}else g=new FormData,l(e,function(a,b){g.append(b,a)}),"undefined"!=typeof d&&g.append(this.flowObj.opts.fileParameterName,d,this.filename||this.fileObj.file.name);return this.xhr.open(a,f,!0),this.xhr.withCredentials=this.flowObj.opts.withCredentials,l(i(this.flowObj.opts.headers,this.fileObj,this,b),function(a,b){this.xhr.setRequestHeader(b,a)},this),g}},d.evalOpts=i,d.extend=k,d.each=l,d.FlowFile=e,d.FlowChunk=g,d.version="2.14.1","object"==typeof module&&module&&"object"==typeof module.exports?module.exports=d:(a.Flow=d,"function"==typeof define&&define.amd&&define("flow",[],function(){return d}))}("undefined"!=typeof window&&window,"undefined"!=typeof document&&document);
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ExifReader=e():t.ExifReader=e()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";var t={d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:1,get:n[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:1})}},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return t+""}(t);return"symbol"==n(e)?e:e+""}t.r(e),t.d(e,{default:function(){return wt},errors:function(){return Et},load:function(){return It},loadView:function(){return Ot}});var o=function(){return t=function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t){return"object"!==n(t)||void 0===t.length||void 0===t.readUInt8||void 0===t.readUInt16LE||void 0===t.readUInt16BE||void 0===t.readUInt32LE||void 0===t.readUInt32BE||void 0===t.readInt32LE||void 0===t.readInt32BE}(e))throw Error("DataView: Passed buffer type is unsupported.");this.buffer=e,this.byteLength=this.buffer.length},(e=[{key:"getUint8",value:function(t){return this.buffer.readUInt8(t)}},{key:"getUint16",value:function(t,e){return e?this.buffer.readUInt16LE(t):this.buffer.readUInt16BE(t)}},{key:"getUint32",value:function(t,e){return e?this.buffer.readUInt32LE(t):this.buffer.readUInt32BE(t)}},{key:"getInt32",value:function(t,e){return e?this.buffer.readInt32LE(t):this.buffer.readInt32BE(t)}}])&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||0,o.configurable=1,"value"in o&&(o.writable=1),Object.defineProperty(t,r(o.key),o)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:0}),t;var t,e}();function i(t,e,n){try{return new DataView(t,e,n)}catch(r){return new o(t,e,n)}}function u(t,e,n){for(var r=[],o=0;o<n&&e+o<t.byteLength;o++)r.push(t.getUint8(e+o));return r.map((function(t){return String.fromCharCode(t)})).join("")}function a(t,e){var n=t.getUint8(e);return[n,u(t,e+1,n)]}function f(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[0][e]=arguments[t][e];return arguments[0]}function c(t,e){return Array(e+1).join(t)}var d={USE_FILE:1,USE_JFIF:1,USE_PNG_FILE:1,USE_EXIF:1,USE_IPTC:1,USE_XMP:1,USE_ICC:1,USE_MPF:1,USE_PHOTOSHOP:1,USE_THUMBNAIL:1,USE_TIFF:1,USE_JPEG:1,USE_PNG:1,USE_HEIC:1,USE_AVIF:1,USE_WEBP:1,USE_GIF:1};function l(t){return t[0][0]/t[0][1]+t[1][0]/t[1][1]/60+t[2][0]/t[2][1]/3600}var s=2,p=65496,h=2,g=4,y=2,m=10,v=65472,b=65474,S=65476,A=65499,U=65501,w=65498,E=65504,I=65505,P=65519,O=65534,T=65535,L="Exif";function F(t,e){var n=L.length;return t.getUint16(e)===I&&u(t,e+g,n)===L&&0===t.getUint8(e+g+n)}function C(t,e){var n=t.getUint16(e);return n>=E&&n<=P||n===O||n===v||n===b||n===S||n===A||n===U||n===w}function x(t,e){return t.getUint16(e)===T}var k={parseAppMarkers:function(t,e){if(function(t){return!!t&&t.byteLength>=s&&t.getUint16(0)===p}(t))return f({},function(t){for(var e,n,r=h;r+g+5<=t.byteLength;){if(F(t,r))e=t.getUint16(r+y),n=r+m;else{if(!C(t,r)){if(x(t,r)){r++;continue}break}e=t.getUint16(r+y)}r+=y+e}return{hasAppMarkers:r>h,fileDataOffset:void 0,jfifDataOffset:void 0,tiffHeaderOffset:n,iptcDataOffset:void 0,xmpChunks:void 0,iccChunks:void 0,mpfDataOffset:void 0}}(t),{fileType:{value:"jpeg",description:"JPEG"}});throw Error("Invalid image format")}},B=18761,M=B,N={271:"Make",272:"Model",306:"DateTime",34665:"Exif IFD Pointer"},j={ApertureValue:function(t){return Math.pow(Math.sqrt(2),t[0]/t[1]).toFixed(2)},ColorSpace:function(t){return 1===t?"sRGB":65535===t?"Uncalibrated":"Unknown"},ComponentsConfiguration:function(t){return t.map((function(t){return 49===t?"Y":50===t?"Cb":51===t?"Cr":52===t?"R":53===t?"G":54===t?"B":void 0})).join("")},Contrast:function(t){return 0===t?"Normal":1===t?"Soft":2===t?"Hard":"Unknown"},CustomRendered:function(t){return 0===t?"Normal process":1===t?"Custom process":"Unknown"},ExposureMode:function(t){return 0===t?"Auto exposure":1===t?"Manual exposure":2===t?"Auto bracket":"Unknown"},ExposureProgram:function(t){return 0===t?"Undefined":1===t?"Manual":2===t?"Normal program":3===t?"Aperture priority":4===t?"Shutter priority":5===t?"Creative program":6===t?"Action program":7===t?"Portrait mode":8===t?"Landscape mode":9===t?"Bulb":"Unknown"},ExposureTime:function(t){if(t[0]/t[1]>.25){var e=t[0]/t[1];return Number.isInteger(e)?""+e:e.toFixed(1)}return 0!==t[0]?"1/".concat(Math.round(t[1]/t[0])):"0/".concat(t[1])},FNumber:function(t){return"f/".concat(t[0]/t[1])},FocalLength:function(t){return t[0]/t[1]+" mm"},FocalPlaneResolutionUnit:function(t){return 2===t?"inches":3===t?"centimeters":"Unknown"},LightSource:function(t){return 1===t?"Daylight":2===t?"Fluorescent":3===t?"Tungsten (incandescent light)":4===t?"Flash":9===t?"Fine weather":10===t?"Cloudy weather":11===t?"Shade":12===t?"Daylight fluorescent (D 5700 – 7100K)":13===t?"Day white fluorescent (N 4600 – 5400K)":14===t?"Cool white fluorescent (W 3900 – 4500K)":15===t?"White fluorescent (WW 3200 – 3700K)":17===t?"Standard light A":18===t?"Standard light B":19===t?"Standard light C":20===t?"D55":21===t?"D65":22===t?"D75":23===t?"D50":24===t?"ISO studio tungsten":255===t?"Other light source":"Unknown"},MeteringMode:function(t){return 1===t?"Average":2===t?"CenterWeightedAverage":3===t?"Spot":4===t?"MultiSpot":5===t?"Pattern":6===t?"Partial":255===t?"Other":"Unknown"},ResolutionUnit:function(t){return 2===t?"inches":3===t?"centimeters":"Unknown"},Saturation:function(t){return 0===t?"Normal":1===t?"Low saturation":2===t?"High saturation":"Unknown"},SceneCaptureType:function(t){return 0===t?"Standard":1===t?"Landscape":2===t?"Portrait":3===t?"Night scene":"Unknown"},Sharpness:function(t){return 0===t?"Normal":1===t?"Soft":2===t?"Hard":"Unknown"},ShutterSpeedValue:function(t){var e=Math.pow(2,t[0]/t[1]);return e<=1?"".concat(Math.round(1/e)):"1/".concat(Math.round(e))},WhiteBalance:function(t){return 0===t?"Auto white balance":1===t?"Manual white balance":"Unknown"},XResolution:function(t){return""+Math.round(t[0]/t[1])},YResolution:function(t){return""+Math.round(t[0]/t[1])}};function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function D(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=R(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return t+""}(t);return"symbol"==R(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:1,configurable:1,writable:1}):t[e]=n,t}var G=f({},N,{33434:{name:"ExposureTime",description:j.ExposureTime},33437:{name:"FNumber",description:j.FNumber},34855:"ISOSpeedRatings",36867:"DateTimeOriginal",37385:{name:"Flash",description:function(t){return 0===t?"Flash did not fire":1===t?"Flash fired":5===t?"Strobe return light not detected":7===t?"Strobe return light detected":9===t?"Flash fired, compulsory flash mode":13===t?"Flash fired, compulsory flash mode, return light not detected":15===t?"Flash fired, compulsory flash mode, return light detected":16===t?"Flash did not fire, compulsory flash mode":24===t?"Flash did not fire, auto mode":25===t?"Flash fired, auto mode":29===t?"Flash fired, auto mode, return light not detected":31===t?"Flash fired, auto mode, return light detected":32===t?"No flash function":65===t?"Flash fired, red-eye reduction mode":69===t?"Flash fired, red-eye reduction mode, return light not detected":71===t?"Flash fired, red-eye reduction mode, return light detected":73===t?"Flash fired, compulsory flash mode, red-eye reduction mode":77===t?"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected":79===t?"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected":89===t?"Flash fired, auto mode, red-eye reduction mode":93===t?"Flash fired, auto mode, return light not detected, red-eye reduction mode":95===t?"Flash fired, auto mode, return light detected, red-eye reduction mode":"Unknown"}},37386:{name:"FocalLength",description:j.FocalLength}}),z="0th",_="exif",H="interoperability",V=D(D(D(D(D(D({},z,G),"1st",N),_,G),"gps",{}),H,{}),"mpf",{}),W={1:1,2:1,3:2,4:4,5:8,7:1,9:4,10:8,13:4},q={BYTE:1,ASCII:2,SHORT:3,LONG:4,RATIONAL:5,UNDEFINED:7,SLONG:9,SRATIONAL:10,IFD:13},J={getAsciiValue:function(t){return t.map((function(t){return String.fromCharCode(t)}))},getByteAt:K,getAsciiAt:function(t,e){return t.getUint8(e)},getShortAt:function(t,e,n){return t.getUint16(e,n===M)},getLongAt:Y,getRationalAt:function(t,e,n){return[Y(t,e,n),Y(t,e+4,n)]},getUndefinedAt:function(t,e){return K(t,e)},getSlongAt:X,getSrationalAt:function(t,e,n){return[X(t,e,n),X(t,e+4,n)]},getIfdPointerAt:function(t,e,n){return Y(t,e,n)},typeSizes:W,tagTypes:q,getTypeSize:function(t){if(void 0===q[t])throw Error("No such type found.");return W[q[t]]}};function K(t,e){return t.getUint8(e)}function Y(t,e,n){return t.getUint32(e,n===M)}function X(t,e,n){return t.getInt32(e,n===M)}var $={1:J.getByteAt,2:J.getAsciiAt,3:J.getShortAt,4:J.getLongAt,5:J.getRationalAt,7:J.getUndefinedAt,9:J.getSlongAt,10:J.getSrationalAt,13:J.getIfdPointerAt};function Q(t,e,n,r,o,i){var u=J.getTypeSize("SHORT"),a={},f=function(t,e,n){return e+J.getTypeSize("SHORT")<=t.byteLength?J.getShortAt(t,e,n):0}(t,r,o);r+=u;for(var c=0;c<f&&!(r+12>t.byteLength);c++){var l=Z(t,e,n,r,o,i);void 0!==l&&(a[l.name]={id:l.id,value:l.value,description:l.description}),r+=12}if(d.USE_THUMBNAIL&&r<t.byteLength-J.getTypeSize("LONG")){var s=J.getLongAt(t,r,o);0!==s&&e===z&&(a.Thumbnail=Q(t,"1st",n,n+s,o,1))}return a}function Z(t,e,n,r,o,i){var u,a=J.getTypeSize("SHORT"),f=a+J.getTypeSize("SHORT"),c=f+J.getTypeSize("LONG"),d=J.getShortAt(t,r,o),l=J.getShortAt(t,r+a,o),s=J.getLongAt(t,r+f,o);if(void 0!==J.typeSizes[l]&&(i||void 0!==V[e][d])){if(function(t,e){return J.typeSizes[t]*e<=J.getTypeSize("LONG")}(l,s))u=tt(t,r+c,l,s,o);else{var p=J.getLongAt(t,r+c,o);u=function(t,e,n,r,o){return e+n+J.typeSizes[r]*o<=t.byteLength}(t,n,p,l,s)?tt(t,n+p,l,s,o,33723===d):"<faulty value>"}l===J.tagTypes.ASCII&&(u=function(t){try{return t.map((function(t){return decodeURIComponent(escape(t))}))}catch(e){return t}}(u=function(t){for(var e=[],n=0,r=0;r<t.length;r++)"\0"!==t[r]?(void 0===e[n]&&(e[n]=""),e[n]+=t[r]):n++;return e}(u)));var h="undefined-".concat(d),g=u;if(void 0!==V[e][d])if(void 0!==V[e][d].name&&void 0!==V[e][d].description){h=V[e][d].name;try{g=V[e][d].description(u)}catch(t){g=et(u)}}else l===J.tagTypes.RATIONAL||l===J.tagTypes.SRATIONAL?(h=V[e][d],g=""+u[0]/u[1]):(h=V[e][d],g=et(u));return{id:d,name:h,value:u,description:g}}}function tt(t,e,n,r,o){var i=[];arguments.length>5&&void 0!==arguments[5]&&arguments[5]&&(r*=J.typeSizes[n],n=J.tagTypes.BYTE);for(var u=0;u<r;u++)i.push($[n](t,e,o)),e+=J.typeSizes[n];return n===J.tagTypes.ASCII?i=J.getAsciiValue(i):1===i.length&&(i=i[0]),i}function et(t){return t instanceof Array?t.join(", "):t}var nt="Exif IFD Pointer",rt="GPS Info IFD Pointer",ot="Interoperability IFD Pointer",it={read:function(t,e,n){var r=function(t,e){if(t.getUint16(e)===B)return B;if(19789===t.getUint16(e))return 19789;throw Error("Illegal byte order value. Faulty image.")}(t,e),o=function(t,e,n,r){return Q(t,z,e,function(t,e,n){return e+J.getLongAt(t,e+4,n)}(t,e,n),n,r)}(t,e,r,n);return function(t,e,n,r,o){return void 0!==t[ot]?f(t,Q(e,H,n,n+t[ot].value,r,o)):t}(o=function(t,e,n,r,o){return void 0!==t[rt]?f(t,Q(e,"gps",n,n+t[rt].value,r,o)):t}(o=function(t,e,n,r,o){return void 0!==t[nt]?f(t,Q(e,_,n,n+t[nt].value,r,o)):t}(o,t,e,r,n),t,e,r,n),t,e,r,n)}};function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function at(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=ut(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=ut(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return t+""}(t);return"symbol"==ut(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:1,configurable:1,writable:1}):t[e]=n,t}function ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var ct={2e3:{name:"PathInformation",description:function(t){for(var e={},n=[],r=0;r<t.byteLength;r+=26){var o=J.getShortAt(t,r);dt[o]&&(e[o]||(e[o]=dt[o].description),n.push({type:o,path:dt[o].path(t,r+2)}))}return JSON.stringify({types:e,paths:n})}},2999:{name:"ClippingPathName",description:function(t){return(e=a(t,0),2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],f=1,c=0;try{for(i=(n=n.call(t)).next,!2;!(f=(r=i.call(n)).done)&&(a.push(r.value),2!==a.length);f=1);}catch(t){c=1,o=t}finally{try{if(!f&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(e)||function(t,e){if(t){if("string"==typeof t)return ft(t,2);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ft(t,2):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1];var e}}},dt=at(at(at(at(at(at(at(at(at({},0,{description:"Closed subpath length",path:function(t,e){return[J.getShortAt(t,e)]}}),1,{description:"Closed subpath Bezier knot, linked",path:lt}),2,{description:"Closed subpath Bezier knot, unlinked",path:lt}),3,{description:"Open subpath length",path:function(t,e){return[J.getShortAt(t,e)]}}),4,{description:"Open subpath Bezier knot, linked",path:lt}),5,{description:"Open subpath Bezier knot, unlinked",path:lt}),6,{description:"Path fill rule",path:function(){return[]}}),8,{description:"Initial fill rule",path:function(t,e){return[J.getShortAt(t,e)]}}),7,{description:"Clipboard",path:function(t,e){return[[pt(t,e,8),pt(t,e+4,8),pt(t,e+8,8),pt(t,e+12,8)],pt(t,e+16,8)]}});function lt(t,e){for(var n=[],r=0;r<24;r+=8)n.push(st(t,e+r));return n}function st(t,e){var n=pt(t,e,8);return[pt(t,e+4,8),n]}function pt(t,e,n){var r,o=J.getLongAt(t,e),i=o>>>31==0?1:-1,u=(2130706432&o)>>>32-n,a=o&parseInt(c("1",32-n),2);return i*function(t,e){return parseInt(t.replace(".",""),2)/Math.pow(2,(t.split(".")[1]||"").length)}(u.toString(2)+"."+(c("0",32-n-(r=a.toString(2)).length)+r))}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var gt={read:function(t,e){for(var n=i(new Uint8Array(t).buffer),r={},o=0;o<t.length;){var a=u(n,o,bt);o+=bt;var f=J.getShortAt(n,o),c=St(n,o+=mt),d=c.tagName;o+=c.tagNameSize;var l=J.getLongAt(n,o);if(o+=vt,a===yt){var s=i(n.buffer,o,l),p={id:f,value:u(s,0,l)};if(ct[f]){try{p.description=ct[f].description(s)}catch(t){p.description="<no description formatter>"}r[d||ct[f].name]=p}else e&&(r["undefined-".concat(f)]=p)}o+=l+l%2}return r}},yt="8BIM",mt=2,vt=4,bt=yt.length;function St(t,e){var n,r=(2,function(t){if(Array.isArray(t))return t}(n=a(t,e))||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],f=1,c=0;try{for(i=(n=n.call(t)).next,!2;!(f=(r=i.call(n)).done)&&(a.push(r.value),2!==a.length);f=1);}catch(t){c=1,o=t}finally{try{if(!f&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(n)||function(t,e){if(t){if("string"==typeof t)return ht(t,2);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(t,2):void 0}}(n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0];return{tagName:r[1],tagNameSize:1+o+(o%2==0?1:0)}}function At(t){this.name="MetadataMissingError",this.message=t||"No Exif data",this.stack=Error().stack}At.prototype=Error();var Ut={MetadataMissingError:At},wt={load:It,loadView:Ot,errors:Ut},Et=Ut;function It(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t){return"string"==typeof t}(t)?(n.async=1,function(t,e){return/^\w+:\/\//.test(t)?"undefined"!=typeof fetch?function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).length,n={method:"GET"};return Number.isInteger(e)&&e>=0&&(n.headers={range:"bytes=0-".concat(e-1)}),fetch(t,n).then((function(t){return t.arrayBuffer()}))}(t,e):function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).length;return new Promise((function(n,r){var o={};Number.isInteger(e)&&e>=0&&(o.headers={range:"bytes=0-".concat(e-1)});var i=function(t){return/^https:\/\//.test(t)?require("https").get:require("http").get}(t);i(t,o,(function(t){if(t.statusCode>=200&&t.statusCode<=299){var e=[];t.on("data",(function(t){return e.push(Buffer.from(t))})),t.on("error",(function(t){return r(t)})),t.on("end",(function(){return n(Buffer.concat(e))}))}else r("Could not fetch file: ".concat(t.statusCode," ").concat(t.statusMessage)),t.resume()})).on("error",(function(t){return r(t)}))}))}(t,e):function(t){return/^data:[^;,]*(;base64)?,/.test(t)}(t)?Promise.resolve(function(t){var e=t.substring(t.indexOf(",")+1);if(-1!==t.indexOf(";base64")){if("undefined"!=typeof atob)return Uint8Array.from(atob(e),(function(t){return t.charCodeAt(0)})).buffer;if("undefined"==typeof Buffer)return;return"undefined"!=typeof Buffer.from?Buffer.from(e,"base64"):new Buffer(e,"base64")}var n=decodeURIComponent(e);return"undefined"!=typeof Buffer?"undefined"!=typeof Buffer.from?Buffer.from(n):new Buffer(n):Uint8Array.from(n,(function(t){return t.charCodeAt(0)})).buffer}(t)):function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).length;return new Promise((function(n,r){var o=function(){try{return require("fs")}catch(t){return}}();o.open(t,(function(i,u){i?r(i):o.stat(t,(function(i,a){if(i)r(i);else{var f=Math.min(a.size,void 0!==e?e:a.size),c=Buffer.alloc(f),d={buffer:c,length:f};o.read(u,d,(function(e){e?r(e):o.close(u,(function(e){e&&console.warn("Could not close file ".concat(t,":"),e),n(c)}))}))}}))}))}))}(t,e)}(t,n).then((function(t){return Pt(t,n)}))):function(t){return"undefined"!=typeof window&&"undefined"!=typeof File&&t instanceof File}(t)?(n.async=1,(e=t,new Promise((function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.onerror=function(){return n(r.error)},r.readAsArrayBuffer(e)}))).then((function(t){return Pt(t,n)}))):Pt(t,n)}function Pt(t,e){return function(t){try{return Buffer.isBuffer(t)}catch(t){return 0}}(t)&&(t=new Uint8Array(t).buffer),Ot(function(t){try{return new DataView(t)}catch(e){return new o(t)}}(t),e)}function Ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{expanded:0,async:0,includeUnknown:0},n=e.expanded,r=void 0===n?0:n,o=e.async,i=void 0===o?0:o,u=e.includeUnknown,a=void 0===u?0:u,c=0,s={},p=k.parseAppMarkers(t,i),h=p.fileType,g=(p.fileDataOffset,p.jfifDataOffset,p.tiffHeaderOffset);if(p.iptcDataOffset,p.xmpChunks,p.iccChunks,p.mpfDataOffset,p.pngHeaderOffset,p.pngTextChunks,p.pngChunkOffsets,p.vp8xChunkOffset,p.gifHeaderOffset,function(t){return void 0!==t}(g)){c=1;var y=it.read(t,g,a);if(y.Thumbnail&&(s.Thumbnail=y.Thumbnail,delete y.Thumbnail),r?(s.exif=y,function(t){if(t.exif){if(t.exif.GPSLatitude&&t.exif.GPSLatitudeRef)try{t.gps=t.gps||{},t.gps.Latitude=l(t.exif.GPSLatitude.value),"S"===t.exif.GPSLatitudeRef.value.join("")&&(t.gps.Latitude=-t.gps.Latitude)}catch(t){}if(t.exif.GPSLongitude&&t.exif.GPSLongitudeRef)try{t.gps=t.gps||{},t.gps.Longitude=l(t.exif.GPSLongitude.value),"W"===t.exif.GPSLongitudeRef.value.join("")&&(t.gps.Longitude=-t.gps.Longitude)}catch(t){}if(t.exif.GPSAltitude&&t.exif.GPSAltitudeRef)try{t.gps=t.gps||{},t.gps.Altitude=t.exif.GPSAltitude.value[0]/t.exif.GPSAltitude.value[1],1===t.exif.GPSAltitudeRef.value&&(t.gps.Altitude=-t.gps.Altitude)}catch(t){}}}(s)):s=f({},s,y),d.USE_PHOTOSHOP&&y.ImageSourceData){var m=gt.read(y.PhotoshopSettings.value,a);r?s.photoshop=m:s=f({},s,m)}}if(delete s.Thumbnail,h&&(r?(s.file||(s.file={}),s.file.FileType=h):s.FileType=h,c=1),!c)throw new Ut.MetadataMissingError;return i?Promise.all([]).then((function(){return s})):s}return e}()}));
//# sourceMappingURL=exif-reader.js.map
((r,n)=>{XF.AttachmentManager=XF.Element.newHandler({options:{uploadButton:".js-attachmentUpload",manageUrl:null,container:".js-attachmentUploads",filesContainer:".js-attachmentFiles",fileRow:".js-attachmentFile",insertMultiRow:".js-attachmentInsertMultiRow",insertRow:".js-attachmentInsert",selectToggleButton:".js-attachmentSelect",selectActionButton:".js-attachmentSelectAction",actionButton:".js-attachmentAction",uploadTemplate:".js-attachmentUploadTemplate",templateProgress:".js-attachmentProgress",
templateError:".js-attachmentError",templateThumb:".js-attachmentThumb",templateView:".js-attachmentView",allowDrop:!1,resizeImages:!0,maxImageWidth:null,maxImageHeight:null,checkVideoSize:!0},container:null,filesContainer:null,template:null,form:null,legacyMode:!1,maxImageWidth:null,maxImageHeight:null,supportsVideoAudioUploads:null,manageUrl:null,flow:null,fileMap:{},exifMap:{},isUploading:!1,lastScroll:0,editor:null,init(){var a=this.options;const b=this.target;if(r.Flow){var c=b.querySelectorAll(a.uploadButton);
if(this.options.manageUrl)this.manageUrl=this.options.manageUrl;else{if(!c.length){console.error("No manage URL specified and no uploaders available.");return}const d=c[0];this.manageUrl=d.dataset.uploadHref||d.getAttribute("href")}this.options.maxImageWidth||this.options.maxImageHeight?(this.maxImageWidth=this.options.maxImageWidth,this.maxImageHeight=this.options.maxImageHeight):(this.maxImageWidth=XF.config.uploadMaxWidth,this.maxImageHeight=XF.config.uploadMaxHeight);this.container=b.querySelector(a.container);
this.filesContainer=b.querySelector(a.filesContainer);this.container?(XF.onDelegated(this.container,"click",a.actionButton,this.actionButtonClick.bind(this)),XF.onDelegated(this.container,"click",'input[type="checkbox"]',this.checkboxClick.bind(this)),XF.onDelegated(this.container,"click",a.selectToggleButton,this.selectToggleClick.bind(this)),XF.onDelegated(this.container,"click",a.selectActionButton,this.selectActionClick.bind(this))):(this.legacyMode=!0,XF.onDelegated(this.filesContainer,"click",
a.actionButton,this.actionButtonClick.bind(this)));(this.template=b.querySelector(a.uploadTemplate).innerHTML)||console.error("No attached file template found.");if(a=this.setupFlow()){if(this.flow=a,this.setupUploadButtons(c,a),this.options.allowDrop&&a.assignDrop([b]),setTimeout(()=>{(this.editor=XF.getEditorInContainer(this.target,"[data-attachment-target=false]"))||this.removeInsertButtons(this.container);this.toggleInsertMultiRow()},50),this.form=this.target.closest("form"))XF.on(this.form,"ajax-submit:before",
d=>{this.isUploading&&!confirm(XF.phrase("files_being_uploaded_are_you_sure"))&&(d.preventSubmit=!0)}),XF.on(this.form,"attachment-manager:reset",this.resetAttachments.bind(this))}else console.error("No flow uploader support")}else console.error("flow.js must be loaded")},setupFlow(){var a=this.getFlowOptions();a=new Flow(a);if(!a.support)return null;a.on("fileAdded",this.fileAdded.bind(this));a.on("filesSubmitted",this.filesSubmitted.bind(this));a.on("fileProgress",this.uploadProgress.bind(this));
a.on("fileSuccess",this.uploadSuccess.bind(this));a.on("fileError",this.uploadError.bind(this));return a},getFlowOptions(){return{target:this.manageUrl,allowDuplicateUploads:!0,fileParameterName:"upload",query:this.uploadQueryParams.bind(this),simultaneousUploads:1,testChunks:!1,progressCallbacksInterval:100,chunkSize:4294967296,readFileFn(a,b,c,d,e){let f="slice";a.file.slice?f="slice":a.file.mozSlice?f="mozSlice":a.file.webkitSlice&&(f="webkitSlice");d||(d="");e.readFinished(a.file[f](b,c,d))}}},
setupUploadButtons(a,b){a.forEach(c=>{var d=c.dataset.accept||"",e=XF.createElementFromString('<span class="js-attachButton"></span>');c.parentNode.insertBefore(e,c.nextSibling);e.appendChild(c);"."==d&&(d="");XF.on(c,"click",f=>f.preventDefault());b.assignBrowse(e,!1,!1,{accept:d});if(null===this.supportsVideoAudioUploads){c=XF.config.allowedVideoExtensions;const f=XF.config.allowedAudioExtensions;d=d.split(",");for(const g in d){const h=d[g].substr(1);if(c.includes(h)||f.includes(h)){this.supportsVideoAudioUploads=
!0;break}}}e=e.querySelector("input[type=file]");e.setAttribute("title",XF.htmlspecialchars(XF.phrase("attach")));e.style.overflow="hidden";e.style[XF.isRtl()?"right":"left"]="-1000px"})},fileAdded(a){var b=this.applyUploadTemplate({filename:a.name,uploading:!0});this.resizeProgress(b,0);XF.DataStore.set(b,"file",a);this.legacyMode?this.filesContainer.classList.add("is-active"):this.container.classList.add("is-active");this.filesContainer.appendChild(b);this.fileMap[a.uniqueIdentifier]=b;var c=this.filesContainer.closest('[data-xf-init="h-scroller"]');
if(c&&(c=XF.Element.getHandler(c,"h-scroller"))){const d=Date.now();this.lastScroll<d-500&&(this.lastScroll=d,c.scrollTo(XF.position(b).left-50))}this.target.querySelector(this.options.uploadButton).blur();b=this.target.querySelector(this.options.uploadButton).dataset.videoSize;if(this.options.checkVideoSize&&this.supportsVideoAudioUploads&&this.isVideoOrAudio(a)&&0<b&&a.size>b)return this.uploadError(a,this.addErrorToJson({},XF.phrase("file_too_large_to_upload"))),!1},isVideoOrAudio(a){var b=a.name.split(".");
a=XF.config.allowedVideoExtensions;const c=XF.config.allowedAudioExtensions;if(1===b.length||""===b[0]&&b.length)return!1;b=b.pop();return a.includes(b)||c.includes(b)},async filesSubmitted(a){await this.preProcessFiles(a);this.setUploading(!0);this.flow.upload()},async preProcessFiles(a){const b=async d=>{try{if(!1===await this.preProcessFile(d))throw Error("File failed pre-processing");}catch(e){this.flow.removeFile(d)}},c=[];for(const d of a)c.push(b(d));await Promise.allSettled(c)},async preProcessFile(a){if("undefined"!==
typeof ExifReader&&a.file.type.startsWith("image/")){try{var b=await ExifReader.load(a.file)}catch(c){b=null}if(b){const c={};for(const d of Object.values(b)){b=d.id;if(!b)continue;let e=d.value;Array.isArray(e)&&(e=1===e.length?e[0]:2===e.length?e.join("/"):d.description);c[b]=e}this.exifMap[a.uniqueIdentifier]=c}}if(this.options.resizeImages&&a.file.type.startsWith("image/"))try{const c=await XF.ImageTools.resize(a.file,this.maxImageWidth,this.maxImageHeight,"optimize"===XF.config.imageOptimization?
"image/webp":null);a.file=c;a.name=c.fileName||c.name;a.size=c.size;a.relativePath=c.relativePath||c.webkitRelativePath||c.name;a.bootstrap()}catch(c){}if(0<XF.config.uploadMaxFilesize&&a.size>XF.config.uploadMaxFilesize)return this.uploadError(a,this.addErrorToJson({},XF.phrase("uploaded_file_is_too_large_for_server_to_process"))),!1},uploadProgress(a){const b=this.fileMap[a.uniqueIdentifier];b&&(this.setUploading(!0),this.resizeProgress(b,a.progress()))},resizeProgress(a,b){b=Math.floor(100*b);
a=a.querySelector(this.options.templateProgress);let c=a.querySelector("i");c||(a.innerHTML="&nbsp;",c=XF.createElement("i",{},a));c.textContent=`${b}%`;c.style.width=`${b}%`},uploadSuccess(a,b,c){b=this.getObjectFromMessage(b);this.setUploading(!1);delete this.exifMap[a.uniqueIdentifier];b.status&&"error"==b.status?this.uploadError(a,b,c):b.attachment?this.insertUploadedRow(b.attachment,this.fileMap[a.uniqueIdentifier]):(b=this.addErrorToJson(b),this.uploadError(a,b,c))},setUploading(a){a=a?!0:!1;
a!==this.isUploading&&((this.isUploading=a)?XF.trigger(this.target,"attachment-manager:upload-start"):XF.trigger(this.target,"attachment-manager:upload-end"))},getObjectFromMessage(a){if(a instanceof Object)return a;try{return JSON.parse(a)}catch(b){return this.addErrorToJson({})}},addErrorToJson(a,b){a.status="error";a.errors=[null===b?XF.phrase("oops_we_ran_into_some_problems"):b];return a},insertUploadedRow(a,b){a=this.applyUploadTemplate(a);this.editor||this.removeInsertButtons(a);b?b.replaceWith(a):
(this.legacyMode?this.filesContainer.classList.add("is-active"):this.container.classList.add("is-active"),this.filesContainer.appendChild(a));XF.activate(a);XF.layoutChange();XF.trigger(a,XF.customEvent("attachment:row-inserted",{newHtml:a,attachmentManager:this}));this.toggleInsertMultiRow()},uploadError(a,b,c){b=this.getObjectFromMessage(b);this.setUploading(!1);delete this.exifMap[a.uniqueIdentifier];const d=this.fileMap[a.uniqueIdentifier];if(d&&b.errors){c=b.errors[0];if(!c)for(const e in b.errors){c=
b.errors[e];break}d.querySelector(this.options.templateProgress).remove();d.querySelector(this.options.templateError).textContent=c;d.classList.add("is-uploadError");delete this.fileMap[a.uniqueIdentifier];XF.DataStore.remove(d,"file")}else XF.defaultAjaxSuccessError(b,200,c.xhr),this.removeFileRow(d)},actionButtonClick(a){a.preventDefault();var b=a.target.closest(this.options.actionButton);a=b.getAttribute("data-action");const c=b.getAttribute("data-type");b=b.closest(this.options.fileRow);switch(a){case "thumbnail":case "full":this.insertAttachment(b,
a,c);break;case "delete":this.deleteAttachment(b,c);break;case "cancel":this.cancelUpload(b)}},checkboxClick(){const a=this.filesContainer.querySelectorAll('input[type="checkbox"]:checked').length;n.querySelectorAll(this.options.selectActionButton).forEach(b=>b.disabled=a?!1:!0)},selectToggleClick(a){a.preventDefault();this.setSelectActionState(!this.container.classList.contains("is-selecting"));a.target.blur()},setSelectActionState(a){const b=this.container;b.classList.contains("is-selecting")!==
a&&(b.querySelectorAll(this.options.selectToggleButton).forEach(c=>{const d=c.getAttribute("data-toggle"),e=c.textContent;c.textContent=d;c.setAttribute("data-toggle",e)}),b.classList[a?"add":"remove"]("is-selecting"))},selectActionClick(a){a.preventDefault();const b=a.target.closest("button").getAttribute("data-action"),c=this.options.fileRow,d=this.options.actionButton,e=this.filesContainer.querySelectorAll(`${c} input[type="checkbox"]:checked`);e.forEach(f=>{f=f.closest(c).querySelectorAll(d);
for(const g of f)if(f=g.dataset.type,("video"===f||"audio"===f)&&"thumbnail"===b){if("full"===g.dataset.action){g.click();break}}else if(g.dataset.action===b){g.click();break}e.forEach(g=>g.checked=!1)});this.container.querySelector(this.options.insertMultiRow).querySelector('input[data-xf-init="check-all"]').checked=!1;this.setSelectActionState(!1)},insertAttachment(a,b,c){c=c||"image";const d=a.dataset.attachmentId;if(d&&this.editor){var e,f=null==(e=a.querySelector(this.options.templateThumb))?
void 0:e.getAttribute("src");a=a.querySelector(this.options.templateView).getAttribute("href");var g;e={id:d,img:f};if("video"==c||"audio"==c)b="full";if("full"==b)b=`[ATTACH=full]${d}[/ATTACH]`,"image"==c?g='<img src="{{img}}" data-attachment="full:{{id}}" alt="" />':"video"==c?g='<span contenteditable="false" draggable="true" class="fr-video fr-dvi fr-draggable fr-deletable"><video data-xf-init="video-init" data-attachment="full:{{id}}" src="{{img}}" controls></video></span>':"audio"==c&&(g='<span contenteditable="false" draggable="true" class="fr-audio fr-dvi fr-draggable fr-deletable"><audio data-attachment="full:{{id}}" src="{{img}}" controls></audio></span>&nbsp;'),
e.img=a;else{if(!f||"image"!==c)return;b=`[ATTACH]${d}[/ATTACH]`;g='<img src="{{img}}" data-attachment="thumb:{{id}}" alt="" />'}g=Mustache.render(g,e);XF.insertIntoEditor(this.target,g,b,"[data-attachment-target=false]")}},deleteAttachment(a,b){b=b||"image";const c=a.dataset.attachmentId;if(c){XF.ajax("post",this.manageUrl,{delete:c},f=>{f.delete&&this.removeFileRow(a)},{skipDefaultSuccess:!0});var d=new RegExp("^[a-z]+:"+c+"$","i"),e=new RegExp("\\[attach[^\\]]*\\]"+c+"\\[/attach\\]","gi");XF.modifyEditorContent(this.target,
f=>{f.ed.$el.find("[data-attachment]").filter(g=>d.test(g.getAttribute("data-attachment"))).each((g,h)=>{"image"===b||"file"===b?f.ed.image.remove(f.ed.$(h)):("video"===b||"audio"===b)&&h.parentNode.remove()})},f=>{let g=f.value;g=g.replace(e,"");f.value=g},"[data-attachment-target=false]")}},cancelUpload(a){const b=XF.DataStore.get(a,"file");a.dataset.attachmentId||b&&1==b.progress()||(this.flow.removeFile(b),this.flow.isUploading()||this.setUploading(!1),this.removeFileRow(a))},uploadQueryParams(a){const b=
{_xfToken:XF.config.csrf,_xfResponseType:"json",_xfWithData:1};void 0!==this.exifMap[a.uniqueIdentifier]&&(b._xfExif=JSON.stringify(this.exifMap[a.uniqueIdentifier]));return b},applyUploadTemplate(a){return XF.createElementFromString(Mustache.render(this.template,a).trim())},removeFileRow(a){a.remove();this.toggleInsertMultiRow();this.getFileRows().length||(this.legacyMode?this.filesContainer.classList.remove("is-active"):this.container.classList.remove("is-active"),XF.layoutChange())},removeInsertButtons(a){null==
a||a.querySelectorAll(`${this.options.insertRow}, ${this.options.insertMultiRow}`).forEach(b=>b.remove());XF.layoutChange()},toggleInsertMultiRow(){this.checkboxClick();let a=Array.from(this.filesContainer.querySelectorAll(this.options.actionButton)).filter(b=>!b.dataset.action||"delete"!==b.dataset.action).map(b=>b.closest(this.options.fileRow));if(this.container){let b=this.container.querySelector(this.options.insertMultiRow);b&&(1<a.length?b.classList.add("is-active"):b.classList.remove("is-active"))}XF.layoutChange()},
resetAttachments(){this.getFileRows().forEach(a=>this.removeFileRow(a))},getFileRows(){return this.filesContainer.querySelectorAll(this.options.fileRow)}});XF.AttachmentOnInsert=XF.Element.newHandler({options:{fileRow:".js-attachmentFile",href:null,linkData:null},loading:!1,init(){const a=this.target.closest(this.options.fileRow);a&&this.options.href||console.error("Cannot find inserted row or action to perform.");XF.on(a,"attachment:row-inserted",this.onAttachmentInsert.bind(this))},onAttachmentInsert(a,
b,c){this.loading||XF.ajax("post",this.options.href,this.options.linkData||{},this.onLoad.bind(this)).finally(()=>this.loading=!1)},onLoad(a){a.html&&XF.setupHtmlInsert(a.html,(b,c,d)=>{this.target.replaceWith(b);XF.Animate.fadeDown(b,{speed:XF.config.speed.xfast,complete(){d(!1,this.target);XF.layoutChange()}})})}});XF.ImageTools={getQuality(a){return XF.config.imageOptimizationQuality||.85},resize(a,b,c,d){return new Promise((e,f)=>{if(a.type.startsWith("image/"))if("image/gif"===a.type)e(a);else{d=
d||a.type;var g=n.createElement("img");g.onload=()=>{let h=g.width,k=g.height,p=!0;(!b||h<=b)&&(!c||k<=c)&&(p=!1);b&&h>b&&(k*=b/h,h=b);c&&k>c&&(h*=c/k,k=c);const l=n.createElement("canvas"),q=l.getContext("2d");null===q?f(Error("Failed to retrieve a valid drawing context.")):(l.width=h,l.height=k,q.drawImage(g,0,0,l.width,l.height),l.toBlob(m=>{null===m?f(Error("Failed to create blob from the canvas.")):(m=new File([m],a.name,{type:d,lastModified:a.lastModified}),!p&&m.size>=a.size?e(a):e(m))},d,
this.getQuality(a)),URL.revokeObjectURL(g.src))};g.src=URL.createObjectURL(a)}else f(Error("The file is not an image."))})}};XF.Element.register("attachment-manager","XF.AttachmentManager");XF.Element.register("attachment-on-insert","XF.AttachmentOnInsert")})(window,document);