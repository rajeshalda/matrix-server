((k,f)=>{XF.AvatarUpload=XF.Element.newHandler({options:{},init(){const a=this.target,b=a.querySelector(".js-uploadAvatar"),c=a.querySelector(".js-avatar"),d=a.querySelector(".js-deleteAvatar");c.querySelector("img")?XF.display(d,"inline-block"):XF.display(d,"none");XF.on(b,"change",this.changeFile.bind(this));XF.on(a,"ajax-submit:response",this.ajaxResponse.bind(this))},changeFile(a){""!=a.target.value&&XF.trigger(this.target,XF.customEvent("submit"))},ajaxResponse(a){const {data:b}=a;if(!b.errors&&
!b.exception){a.preventDefault();b.message&&XF.flashMessage(b.message,3E3);var c=this.target;a=c.querySelector(".js-deleteAvatar");var d=c.querySelector(".js-uploadAvatar"),e=c.querySelector(".js-avatar"),g=c.querySelector(".js-avatarX"),h=c.querySelector(".js-avatarY");if(c=1==c.querySelector('input[name="use_custom"]:checked').value)e.style.left=`${-1*b.cropX}px`,e.style.top=`${-1*b.cropY}px`,g.value=b.cropX,h.value=b.cropY,XF.Element.initializeElement(e),d.value="";else if(f.querySelector(".js-gravatarPreview").src=
b.gravatarTest?b.gravatarPreview:b.gravatarUrl,b.gravatarTest)return;XF.updateAvatars(b.userId,b.avatars,c);b.defaultAvatars?XF.display(a,"none"):XF.display(a,"inline-block");a=f.querySelector(".js-avatarCropper");XF.trigger(a,XF.customEvent("avatar:updated",{data:b}))}}});XF.AvatarCropper=XF.Element.newHandler({options:{size:96,x:0,y:0},img:null,size:96,x:0,y:0,imgW:null,imgH:null,cropSize:null,scale:null,init(){XF.on(this.target,"avatar:updated",this.avatarsUpdated.bind(this),{once:!0});(this.img=
this.target.querySelector("img"))&&this.initTest()},avatarsUpdated(a){this.options.x=a.data.cropX;this.options.y=a.data.cropY;this.init()},initTest(){const a=this.img;let b=0;const c=()=>{b++;50<b||(0<a.naturalWidth?this.setup():0===a.naturalWidth&&setTimeout(c,100))};c()},setup(){this.imgW=this.img.naturalWidth;this.imgH=this.img.naturalHeight;this.cropSize=Math.min(this.imgW,this.imgH);this.scale=this.cropSize/this.options.size;new XF.CropBox(this.img,{width:this.size,height:this.size,zoom:0,maxZoom:0,
result:{cropX:this.options.x*this.scale,cropY:this.options.y*this.scale,cropW:this.cropSize,cropH:this.cropSize}});XF.on(this.img,"cropbox",this.onCrop.bind(this));if(XF.browser.mozilla)XF.on(this.img,"mousedown",a=>a.preventDefault())},onCrop(a){this.target.parentNode.querySelector(".js-avatarX").value=a.results.cropX/this.scale;this.target.parentNode.querySelector(".js-avatarY").value=a.results.cropY/this.scale}});XF.Element.register("avatar-upload","XF.AvatarUpload");XF.Element.register("avatar-cropper",
"XF.AvatarCropper")})(window,document);
