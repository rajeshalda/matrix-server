((C,u)=>{XF.FE=FroalaEditor;XF.isEditorEnabled=()=>XF.LocalStorage.get("editorDisabled")?!1:!0;XF.setIsEditorEnabled=a=>{a?XF.LocalStorage.remove("editorDisabled"):XF.LocalStorage.set("editorDisabled","1",!0)};XF.Editor=XF.Element.newHandler({options:{maxHeight:.7,minHeight:250,buttonsRemove:"",attachmentTarget:!0,deferred:!1,attachmentUploader:".js-attachmentUpload",attachmentContextInput:"attachment_hash_combined"},edMinHeight:63,form:null,buttonManager:null,ed:null,mentioner:null,emojiCompleter:null,
uploadUrl:null,init(){if(this.target.matches("textarea")){this.options.minHeight=Math.max(this.edMinHeight,this.options.minHeight);XF.trigger(u,XF.customEvent("editor:start",{editor:this}));this.form=this.target.closest("form");this.form||(this.form=null);if(this.options.attachmentTarget){let a,b;this.uploadUrl=null==(b=null==(a=this.target.closest("[data-xf-init~=attachment-manager]"))?void 0:a.querySelector(this.options.attachmentUploader))?void 0:b.getAttribute("href")}this.options.deferred||this.startInit()}else console.error("Editor can only be initialized on a textarea")},
startInit(a){const b=a&&a.beforeInit,e=a&&a.afterInit;this.target.style.visibility="";this.ed=new FroalaEditor(this.target,this.getEditorConfig(),()=>{b&&b(this,this.ed);this.editorInit();e&&e(this,this.ed)})},reInit(a){this.ed&&(this.ed.destroy(),this.startInit(a))},getEditorConfig(){var a=this.getHeightLimits();a={attribution:!1,direction:FroalaEditor.LANGUAGE.xf.direction,editorClass:"bbWrapper",fileUpload:!1,fileMaxSize:4294967296,fileUploadParam:"upload",fileUploadURL:!1,fontFamily:{arial:"Arial",
"'book antiqua'":"Book Antiqua","'courier new'":"Courier New",georgia:"Georgia",tahoma:"Tahoma","'times new roman'":"Times New Roman","'trebuchet ms'":"Trebuchet MS",verdana:"Verdana"},fontSize:"9 10 12 15 18 22 26".split(" "),heightMin:a[0],heightMax:a[1],htmlAllowedTags:"a audio b bdi bdo blockquote br cite code dfn div em h1 h2 h3 h4 h5 h6 hr i img li mark ol p pre s small span strike strong sub sup table tbody td tfoot th thead time tr u ul var video wbr".split(" "),key:"ZOD3gA8B10A6C5A2G3C-8TMIBDIa1NTMNZFFPFZc1d1Ib2a1E1fA4A3G3F3F2B6C4C4C3G3==",
htmlAllowComments:!1,iconsTemplate:"fa_svg",imageUpload:!1,imageCORSProxy:null,imageDefaultDisplay:"inline",imageDefaultWidth:0,imageEditButtons:"imageAlign imageSize imageAlt | imageReplace imageRemove | imageLink linkOpen linkEdit linkRemove".split(" "),imageManagerLoadURL:!1,imageMaxSize:4294967296,imagePaste:!1,imageResize:!0,imageUploadParam:"upload",imageUploadRemoteUrls:!1,imageUploadURL:!1,language:"xf",linkAlwaysBlank:!0,linkEditButtons:["linkOpen","linkEdit","linkRemove"],linkInsertButtons:["linkBack"],
listAdvancedTypes:!1,paragraphFormat:{N:"Normal",H2:"Heading 1",H3:"Heading 2",H4:"Heading 3"},placeholderText:"",tableResizer:!0,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns"],toolbarSticky:!1,toolbarStickyOffset:36,tableInsertHelper:!1,videoAllowedTypes:["mp4","quicktime","ogg","webm"],videoAllowedProviders:[],videoDefaultAlign:"center",videoDefaultDisplay:"inline",videoDefaultWidth:500,videoEditButtons:["videoReplace","videoRemove","|","videoAlign","videoSize"],videoInsertButtons:["videoBack",
"|","videoUpload"],videoMaxSize:4294967296,videoMove:!0,videoUpload:!1,videoUploadParam:"upload",videoUploadURL:!1,zIndex:XF.getElEffectiveZIndex(this.target)+1,xfBbCodeAttachmentContextInput:this.options.attachmentContextInput};FroalaEditor.DefineIconTemplate("fa_svg",XF.Icon.getIcon("default","[FA5NAME]"));FroalaEditor.DefineIconTemplate("fal_svg",XF.Icon.getIcon("fal","[FA5NAME]"));FroalaEditor.DefineIconTemplate("far_svg",XF.Icon.getIcon("far","[FA5NAME]"));FroalaEditor.DefineIconTemplate("fas_svg",
XF.Icon.getIcon("fas","[FA5NAME]"));FroalaEditor.DefineIconTemplate("fad_svg",XF.Icon.getIcon("fad","[FA5NAME]"));FroalaEditor.DefineIconTemplate("fab_svg",XF.Icon.getIcon("fab","[FA5NAME]"));FroalaEditor.DefineIcon("insertVideo",{FA5NAME:"video-plus"});if(this.uploadUrl){var b={_xfToken:XF.config.csrf,_xfResponseType:"json",_xfWithData:1};a.fileUpload=!0;a.fileUploadParams=b;a.fileUploadURL=this.uploadUrl;a.imageUpload=!0;a.imageUploadParams=b;a.imageUploadURL=this.uploadUrl;a.imagePaste=!0;a.videoUpload=
!0;a.videoUploadParams=b;a.videoUploadURL=this.uploadUrl}else a.imageInsertButtons=["imageByURL"];b=this.getButtonConfig();a=XF.extendObject({},a,b);XF.trigger(this.target,XF.customEvent("editor:config",{config:a,editor:this}));return a},getButtonConfig(){try{var a=JSON.parse(u.querySelector(".js-editorToolbars").innerHTML)||{}}catch(d){console.error("Editor buttons data not valid: ",d);return}var b={};let e;try{e=JSON.parse(u.querySelector(".js-editorDropdowns").innerHTML)||{};for(const d of Object.keys(e))e[d].buttons&&
(b[d]=e[d].buttons)}catch(d){console.error("Editor dropdowns data not valid: ",d)}this.buttonManager=a=new XF.EditorButtons(this,a,b);XF.isElementWithinDraftForm(this.target)||a.addRemovedButton("xfDraft");(b=this.getAttachmentManager())&&b.supportsVideoAudioUploads||a.addRemovedButton("insertVideo");this.options.buttonsRemove&&a.addRemovedButtons(this.options.buttonsRemove.split(","));XF.trigger(this.target,XF.customEvent("editor:toolbar-buttons",{buttonManager:a,editor:this}));return a.getToolbars()},
editorInit(){const a=this.ed,b=this;this.watchEditorHeight();this.form&&(XF.on(this.form,"ajax-submit:before",()=>XF.EditorHelpers.sync(a)),XF.on(this.form,"draft:beforesync",()=>XF.EditorHelpers.sync(a)),XF.on(this.form,"draft:complete",c=>{({data:c}=c);let f;a.$tb.length&&!0===c.draft.saved&&(c=a.$tb[0].querySelector(".fr-command.fr-btn[data-cmd=xfDraft]"))&&(f=c.querySelector(".editorDraftIndicator"),f||(f=XF.createElementFromString('<b class="editorDraftIndicator"></b>'),c.appendChild(f)),setTimeout(()=>
{f.classList.add("is-active")},50),setTimeout(()=>{f.classList.remove("is-active")},2500))}),XF.on(this.form,"ajax-submit:before",function(c){0<a.$el.find(".fr-uploading").length&&!confirm(XF.phrase("files_being_uploaded_are_you_sure"))&&c.preventDefault()}),a.events.on("keydown",function(c){if("Enter"==c.key&&(XF.isMac()?c.metaKey:c.ctrlKey))return c.preventDefault(),XF.trigger(b.form,"submit"),!1},!0),XF.isElementWithinDraftForm(this.form)&&XF.Element.applyHandler(a.$el[0],"draft-trigger"));a.events.on("image.inserted",
function(c){c.removeClass("fr-dib").addClass("fr-dii")});a.events.on("image.beforePasteUpload",function(c){if("data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="==c.src)return!1});let e=!1;a.events.on("cut copy",function(c){if((c=a.selection.ranges(0))&&c.commonAncestorContainer){var f=c.commonAncestorContainer;if(f.nodeType==Node.TEXT_NODE)if(0==c.startOffset&&c.endOffset==f.length&&f.parentNode!=a.$el[0]){for(f=f.parentNode;f.parentNode!=a.$el[0]&&!f.previousSibling&&!f.nextSibling;)f=
f.parentNode;c.selectNode(f)}else f=f.parentNode;var g=f.querySelectorAll("p");g.forEach(n=>n.setAttribute("data-xf-p","1"));setTimeout(function(){g.forEach(n=>n.removeAttribute("data-xf-p"))},0)}});a.events.on("paste.before",function(c){e=!1;if(c&&c.clipboardData&&c.clipboardData.getData){let f="";c=c.clipboardData.types;if(a.helpers.isArray(c))for(const g of c)f+=g+";";else f=c;!/text\/plain/.test(f)||a.browser.mozilla||/text\/html/.test(f)||/text\/rtf/.test(f)&&a.browser.safari||(e=!0)}});a.events.on("paste.beforeCleanup",
function(c){e&&(c=c.replace(/\t/g,"    ").replace(/ {2}/g,"&nbsp; ").replace(/ {2}/g,"&nbsp; ").replace(/> /g,">&nbsp;"));c=c.replace(/(<pre[^>]*>)([\s\S]+?)(<\/pre>)/g,function(n,k,l,m){l=l.replace(/\r?\n/g,"<br>");return k+l+m});c=c.replace(/<p([^>]+)margin-top:\s*0[a-z]*;\s*margin-bottom:\s*0[a-z]*;([^>]*)>([\s\S]*?)<\/p>/g,function(n,k,l,m){return"<p"+k+l+' data-xf-p="1">'+m+"</p>"});c=c.replace(/<div(?=\s|>)/g,function(n){return n+' data-xf-p="1"'});var f;(f=c.match(/^(?:<meta[^>]*>)?<a href=(?:'|")([^'"]*)\/?(?:'|")>\1<\/a>$/))&&
(c=f[1].trim());(f=c.match(/\x3c!--StartFragment--\x3e<a href=(?:'|")([^'"]*)\/?(?:'|")>[^<]+<\/a>\x3c!--EndFragment--\x3e/))&&(c=f[1].trim());c=XF.adjustHtmlForRte(c);c=u.createRange().createContextualFragment(c);c=Array.from(c.childNodes);const g=function(n){let k,l,m,p;for(m=0;m<n.length;m++)if(k=n[m],k instanceof Element){if(k.hasAttributes())for(l=k.attributes,p=l.length-1;0<=p;p--){const q=l[p];"on"!=q.name.toLowerCase().substr(0,2)&&"style"!=q.name.toLowerCase()||k.removeAttribute(q.name)}g(k.childNodes)}};
g(c);f=XF.createElementFromString("<div></div>");f.append(...c);f.querySelectorAll("span.smilie").forEach(n=>{const k=n.getAttribute("data-shortname");n.getAttribute("data-smilie")&&k?u.createTextNode(XF.htmlspecialchars(k)).after(n):Array.from(n.childNodes).forEach(l=>n.parentNode.insertBefore(l,n));n.remove()});return f.innerHTML.trim()});a.events.on("paste.afterCleanup",function(c){return b.normalizePaste(c)});a.events.on("paste.after",function(){var c=a.selection.ranges(0);if(c&&c.getBoundingClientRect){c=
c.getBoundingClientRect();var f=u.documentElement,g=a.$wp[0].getBoundingClientRect();(0>c.top||0>c.left||c.bottom>f.clientHeight||c.right>f.clientWidth||c.bottom>g.bottom)&&setTimeout(function(){b.scrollToCursor()},100);XF.EditorHelpers.normalizeBrForEditor(a.$el[0])}});var d={url:XF.getAutoCompleteUrl()};this.mentioner=new XF.AutoCompleter(a.$el[0],d,a);XF.config.shortcodeToEmoji&&(d={url:XF.canonicalizeUrl("index.php?misc/find-emoji"),at:":",keepAt:!1,insertMode:"html",displayTemplate:'<div class="contentRow"><div class="contentRow-figure contentRow-figure--emoji">{{{icon}}}</div><div class="contentRow-main contentRow-main--close">{{{text}}}<div class="contentRow-minor contentRow-minor--smaller">{{{desc}}}</div></div></div>',
beforeInsert(c,f){XF.logRecentEmojiUsage(f.querySelector("img.smilie").dataset.shortname);return c}},this.emojiCompleter=new XF.AutoCompleter(a.$el[0],d,a));this.setupUploads();if(!XF.isEditorEnabled()){for(d=this.target.nextElementSibling;d&&!d.matches("input[data-bb-code]");)d=d.nextElementSibling;d?a.bbCode.toBbCode(d.value,!0):a.bbCode.toBbCode(null,!0)}XF.EditorHelpers.setupBlurSelectionWatcher(a);XF.on(this.target,"control:enabled",function(){a.edit.on()});XF.on(this.target,"control:disabled",
function(){a.edit.off()});XF.on(this.target,"control:enabled",function(){a.edit.on();a.bbCode&&a.bbCode.isBbCodeView()?a.$tb.find(".fr-command[data-cmd=xfBbCode]").removeClass("fr-disabled"):a.toolbar.enable()});XF.on(this.target,"control:disabled",function(){a.edit.off();a.toolbar.disable();a.$tb.find(" > .fr-command").addClass("fr-disabled")});XF.trigger(this.target,XF.customEvent("editor:init",{ed:a,editor:this}));XF.layoutChange()},focus(){XF.EditorHelpers.focus(this.ed)},blur(){XF.EditorHelpers.blur(this.ed)},
normalizePaste(a){a=a.replace(/(<(ul|li|p|div)>)\s+/ig,"$1");a=a.replace(/\s+(<\/(ul|li|p|div)>)/ig,"$1");a=a.replace(/<span>&nbsp;<\/span>/ig," ").replace(/(<\/li>)\s+(<li)/ig,"$1$2");const b=this.ed;a=u.createRange().createContextualFragment(a);const e=XF.createElementFromString("<div></div>");a=Array.from(a.childNodes);e.append(...a);e.querySelectorAll("table").forEach(k=>{k.style.width="100%";const l=XF.createElementFromString('<div class="bbTable"></div>');k.parentNode.insertBefore(l,k);l.appendChild(k);
k.querySelectorAll("[colspan], [rowspan]").forEach(p=>{p.removeAttribute("colspan");p.removeAttribute("rowspan")});let m=0;k.querySelectorAll("> tbody > tr").forEach(p=>{p=p.querySelectorAll("> td, > th").length;m=Math.max(m,p)});k.querySelectorAll("> tbody > tr").forEach(p=>{var q=p.querySelectorAll("> td, > th"),w=q.length;if(w<m)for(q=w&&"TH"===q[0].tagName?"<th />":"<td />";w<m;w++){const x=u.createElement(q);p.appendChild(x)}})});e.querySelectorAll("code, del, ins, sub, sup").forEach(k=>{const l=
u.createTextNode(k.innerHTML);k.parentNode.replaceChild(l,k)});let d=!1;e.querySelectorAll("h1").forEach(k=>{d=!0;const l=u.createElement("h2");l.appendChild(...k.childNodes);k.parentNode.replaceChild(l,k)});const c={H2:d?"H3":"H2",H3:d?"H4":"H3",H4:"H4",H5:"H4",H6:"H4"};e.querySelectorAll("h2, h3, h4, h5, h6").forEach(k=>{const l=u.createElement(c[k.tagName]);l.appendChild(...k.childNodes);k.parentNode.replaceChild(l,k)});if(a=e.querySelector("pre")){var f=a.innerHTML;f=f.replace(/\r?\n/g,"<br>").replace(/\t/g,
"    ").replace(/ {2}/g,"&nbsp; ").replace(/ {2}/g,"&nbsp; ").replace(/> /g,">&nbsp;").replace(/<br> /g,"<br>&nbsp;");var g=u.createElement("div");g.innerHTML=f+"<br>";a.parentNode.replaceChild(g,a)}b.opts.imagePaste||e.querySelectorAll("img[data-fr-image-pasted]").forEach(k=>{k.getAttribute("src").match(/https?:\/\//i)&&k.removeAttribute("data-fr-image-pasted")});e.querySelectorAll("br").forEach(k=>{for(var l=[],m=k.parentNode;m&&m!==e;)l.push(m),m=m.parentNode;if(0!==l.length&&!l.some(x=>b.node.isBlock(x))){m=
[];var p=!1,q=k;l=l[l.length-1];do{for(;q.nextSibling;){var w=q.nextSibling.cloneNode(!0);p?m.push(w):m=m.concat(w);q.parentNode.removeChild(q.nextSibling)}q=q.parentNode;if(!q||q===e)break;w=q.cloneNode();w.innerHTML="";m.forEach(x=>{w.appendChild(x)});m=[w];p=!0}while(q.parentNode&&q.parentNode!==e);k.parentNode.removeChild(k);l.after(...m);l.after(u.createElement("br"))}});a="";f=e.textContent.replace(/\s/g,"");try{a=(b.win.localStorage.getItem("fr-copied-text")||"").replace(/\s/g,"")}catch(k){}a!==
f&&e.querySelectorAll("p:not([data-xf-p])").forEach(k=>{if(k.nextSibling){const l=u.createElement("p");k.parentNode.insertBefore(l,k.nextSibling)}});e.querySelectorAll("p").forEach(k=>k.removeAttribute("data-xf-p"));f=Array.from(e.childNodes);a=u.createElement("div");g=null;for(var n of f)n.nodeType===Node.ELEMENT_NODE&&b.node.isBlock(n)?(a.appendChild(n),g=null):n.nodeType===Node.ELEMENT_NODE&&"BR"===n.tagName?(g||a.appendChild(u.createElement("p")),g=null):(g||(g=u.createElement("p"),a.appendChild(g)),
g.appendChild(n));n=a.children;1!==n.length||"P"!==n[0].tagName&&"DIV"!==n[0].tagName||(a=n[0]);return XF.EditorHelpers.normalizeBrForEditor(a.innerHTML)},watchEditorHeight(){const a=this.ed;XF.on(C,"resize",()=>{const d=this.getHeightLimits();a.opts.heightMin=d[0];a.opts.heightMax=d[1];a.size.refresh();XF.layoutChange()},{passive:!0});a.events.on("focus",()=>this.scrollToCursorAfterPendingResize());let b=a.$wp.height();const e=()=>{const d=a.$wp.height();b!=d&&(b=d,XF.layoutChange())};a.events.on("keyup",
e);a.events.on("commands.after",e);a.events.on("html.set",e);a.events.on("init",e);a.events.on("initialized",e)},getHeightLimits(){let a=this.options.maxHeight;const b=this.options.minHeight;var e=null;let d=null;this.target.closest(".overlay")&&(a=.1);a&&(e=u.documentElement.clientHeight,/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(e-=250),e=Math.floor(0<a?1>=a?e*a:a:e+a),e=Math.max(e,150));b&&e&&(d=Math.min(b,e),d==e&&--d);return[d,e]},setupUploads(){const a=this,b=this.ed;b.events.on("file.uploaded",
function(d){this.popups.hide("file.insert");this.events.focus();return a.handleUploadSuccess(d)});b.events.on("file.error",function(d,c){this.popups.hide("file.insert");a.handleUploadError(d,c);this.events.focus();return!1});this.uploadUrl||(b.events.on("image.beforeUpload",function(){return!1}),b.events.on("file.beforeUpload",function(){return!1}),b.events.on("video.beforeUpload",function(){return!1}));b.events.on("image.error",function(d,c){if(c)return this.popups.hide("image.insert"),a.handleUploadError(d,
c),!1});b.events.on("video.error",function(d,c){if(c)return this.popups.hide("video.insert"),a.handleUploadError(d,c),!1});b.events.on("image.uploaded",function(d){return a.handleUploadSuccess(d,function(){b.image.remove();b.popups.hide("image.insert");b.events.focus();return!1},function(){return!0})});b.events.on("video.uploaded",function(d){return a.handleUploadSuccess(d,function(){b.video.remove();b.popups.hide("video.insert");b.events.focus();return!1},function(){return!0})});const e=function(d,
c){if(c){try{var f=JSON.parse(c)}catch(g){return}d.hasClass("fr-video")&&(d=d.find("video"),d.attr("data-xf-init","video-init").attr("style","").empty());if(f.attachment){f=f.attachment.attachment_id;c=d[0].attributes;const g=/^data-(?!xf-init)/;for(let n=c.length-1;0<=n;n--)g.test(c[n].nodeName)&&d.removeAttr(c[n].nodeName);d.attr("data-attachment","full:"+f)}}};b.events.on("image.inserted video.inserted",e);b.events.on("image.replaced video.replaced",e);b.events.on("image.loaded",function(d){if(b.popups.isVisible("image.edit")){var c=
b.image.get();c&&c[0]==d[0]&&(c.attr("data-size",`${c[0].naturalWidth}x${c[0].naturalHeight}`),b.image.exitEdit(!0),c=b.selection.ranges(0),c.setStartAfter(d[0]),c.collapse(!0),d=b.selection.get(),d.removeAllRanges(),d.addRange(c),b.events.focus(),a.scrollToCursor())}});b.events.on("video.loaded",function(d){if(b.popups.isVisible("video.edit")){var c=b.video.get();c&&c[0]==d[0]&&(b.events.trigger("video.hideResizer"),b.popups.hide("video.edit"),c=b.selection.ranges(0),c.setStartAfter(d[0]),c.collapse(!0),
d=b.selection.get(),d.removeAllRanges(),d.addRange(c),b.events.focus(),a.scrollToCursor())}});b.events.on("popups.show.image.edit",function(){const d=b.image.get();d.length&&d.hasClass("smilie")&&(b.image.exitEdit(!0),b.selection.save(),setTimeout(function(){b.selection.restore()},0))})},handleUploadSuccess(a,b,e){let d;try{d=JSON.parse(a)}catch(c){d={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]}}return d.status&&"error"==d.status?(XF.alert(d.errors[0]),b?b(d):!1):(a=this.getAttachmentManager())&&
d.attachment?(a.insertUploadedRow(d.attachment),e?e(d,a):!1):!1},handleUploadError(a,b){let e;try{e=JSON.parse(b)}catch(d){e=null}e&&e.errors||(e={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]});XF.alert(e.errors[0])},getAttachmentManager(){const a=this.target.closest("[data-xf-init~=attachment-manager]");return a?XF.Element.getHandler(a,"attachment-manager"):null},isBbCodeView(){return this.ed.bbCode&&this.ed.bbCode.isBbCodeView?this.ed.bbCode.isBbCodeView():!1},insertContent(a,
b){const e=this.ed;this.isBbCodeView()?"undefined"!==typeof b&&e.bbCode.insertBbCode(b):(this.focus(),e.undo.saveStep(),e.html.insert(a),e.undo.saveStep(),XF.Element.initialize(e.$el[0]),XF.EditorHelpers.normalizeAfterInsert(e));this.scrollToCursor();this.scrollToCursorAfterPendingResize()},replaceContent(a,b){const e=this.ed;this.isBbCodeView()?"undefined"!==typeof b&&e.bbCode.replaceBbCode(b):e.html.set(a)},scrollToCursor(){const a=this.ed;if(this.isBbCodeView())a.bbCode.getTextArea().autofocus(),
a.$box[0].scrollIntoView(!0);else{this.focus();var b=a.$box;const d=a.$wp,c=a.selection.endElement();var e=c.getBoundingClientRect().bottom;let f=!0,g=XF.windowHeight();XF.browser.ios&&(g-=250);if(0>e||e>=g)f=!1;if(d&&f){const n=d[0].getBoundingClientRect();if(e>n.bottom||e<n.top)f=!1}if(!f){e=b[0].getBoundingClientRect();if(0>e.top||e.bottom>=g)XF.browser.ios||b.addClass("is-scrolling-to"),b[0].scrollIntoView(!0),b.removeClass("is-scrolling-to");d?(b=a.position.getBoundingRect().top,b>d.offset().top-
a.helpers.scrollTop()+d.height()-50&&d.scrollTop(b+d.scrollTop()-(d.height()+d.offset().top)+a.helpers.scrollTop()+g/2)):c.scrollIntoView()}}},scrollToCursorAfterPendingResize(a){const b=function(){c&&clearTimeout(c);c=setTimeout(g,100)},e=this,d=this.ed;let c;const f=function(){XF.off(C,"resize",f);XF.on(C,"scroll",b);c&&clearTimeout(c);c=setTimeout(g,500)},g=function(){XF.off(C,"scroll",b);d.core.hasFocus()&&e.scrollToCursor()};XF.on(C,"resize",f);setTimeout(function(){XF.off(C,"resize",f)},2E3);
a&&(c=setTimeout(g,1E3))},base64ToBytes(a,b){b=b||512;a=atob(a);const e=[];for(let c=0;c<a.length;c+=b){var d=a.slice(c,c+b);const f=Array(d.length);for(let g=0;g<d.length;g++)f[g]=d.charCodeAt(g);d=new Uint8Array(f);e.push(d)}return e},editorSupportsUploads(){return-1!==this.ed.opts.imageInsertButtons.indexOf("imageUpload")},imageMatchesBase64Encoding(a){return a.attr("src").match(/^data:(image\/([a-z0-9]+));base64,(.*)$/)},replaceBase64ImageWithUpload(a){if(!a.hasClass("smilie")){var b;if(b=this.imageMatchesBase64Encoding(a)){var e=
b[1];var d=b[2];b=b[3];-1===this.ed.opts.imageAllowedTypes.indexOf(d)?a[0].remove():this.editorSupportsUploads()?(a=new Blob(this.base64ToBytes(b),{type:e}),1024<a.size&&this.ed.image.upload([a])):a[0].remove()}}},isInitialized(){return this.ed?!0:!1}});XF.EditorButtons=XF.create({xfEd:null,buttonClasses:null,toolbars:{},dropdowns:{},removeButtons:null,recalculateNeeded:!0,__construct(a,b,e){this.xfEd=a;this.removeButtons=[];b&&(this.toolbars=b);e&&(this.dropdowns=e)},addToolbar(a,b){this.toolbars[a]=
b;this.recalculateNeeded=!0},adjustToolbar(a,b){const e=this.toolbars[a];return e?(this.toolbars[a]=b(e,a,this),this.recalculateNeeded=!0):!1},adjustToolbars(a){for(const b of Object.keys(this.toolbars))this.adjustToolbar(b,a)},getToolbar(a){return this.getToolbars()[a]},getToolbars(){this.recalculateIfNeeded();if(XF.EditorHelpers.isPreviewAvailable(this.xfEd.target))for(const a of Object.keys(this.toolbars))this.toolbars[a].preview={buttons:["xfPreview"],align:"right"};return this.toolbars},addDropdown(a,
b){this.dropdowns[a]=b;this.recalculateNeeded=!0},adjustDropdown(a,b){const e=this.dropdowns[a];return e?(this.dropdowns[a]=b(e,a,this),this.recalculateNeeded=!0):!1},adjustDropdowns(a){for(const b of Object.keys(this.dropdowns))this.adjustDropdown(b,a)},getDropdown(a){return this.getDropdowns()[a]},getDropdowns(){this.recalculateIfNeeded();return this.dropdowns},addRemovedButton(a){this.removeButtons.push(a);this.recalculateNeeded=!0},addRemovedButtons(a){for(const b of a)this.removeButtons.push(b);
this.recalculateNeeded=!0},recalculateIfNeeded(){this.recalculateNeeded&&this.recalculate()},recalculate(){function a(k,l){if(!k.filter)return[];"string"==typeof l&&e[l]&&(l=e[l]);"string"==typeof l&&(l=l.split("|"));return k.filter(function(m){return!(0<=l.indexOf(m))})}const b=this.removeButtons,e=this.getButtonClasses();let d,c,f,g,n;for(n=0;n<b.length;n++){d=b[n];for(c of Object.keys(this.toolbars))for(g of Object.keys(this.toolbars[c]))this.toolbars[c][g].buttons=a(this.toolbars[c][g].buttons,
d);for(f of Object.keys(this.dropdowns))this.dropdowns[f]=a(this.dropdowns[f],d)}for(f of Object.keys(this.dropdowns))if(!this.dropdowns[f].length)for(c of Object.keys(this.toolbars))for(g of Object.keys(this.toolbars[c]))this.toolbars[c][g].buttons=a(this.toolbars[c][g].buttons,f);this.recalculateNeeded=!1},getButtonClasses(){this.buttonClasses||(this.buttonClasses={_basic:["bold","italic","underline","strikeThrough"],_extended:["textColor","fontFamily","fontSize","xfInlineCode","paragraphFormat"],
_link:["insertLink"],_align:["align","alignLeft","alignCenter","alignRight","alignJustify"],_list:["formatOL","formatUL","outdent","indent"],_indent:["outdent","indent"],_smilies:["xfSmilie"],_image:["insertImage","xfInsertGif"],_media:["insertVideo","xfMedia"],_block:"xfQuote xfCode xfSpoiler xfInlineSpoiler insertTable insertHR".split(" ")});return this.buttonClasses}});XF.EditorHelpers={toolbarSizes:{SM:420,MD:550,LG:800},setupBlurSelectionWatcher(a){const b=a.$el;let e=!1,d;const c=f=>{e&&(a.$el[0]==
f.target||a.$el[0].contains(f.target)||a.selection.inEditor()&&(d=a.selection.ranges(0)))};XF.on(u,"mousedown",c);XF.on(u,"keydown",c);a.events.on("blur",function(){a.$box.removeClass("is-focused");d?b.data("xf-ed-blur-sel",d):b.removeData("xf-ed-blur-sel");e=!1;d=null},!0);a.events.on("focus",function(){a.$box.addClass("is-focused");e=!0;d=null;setTimeout(function(){b.removeData("xf-ed-blur-sel")},0)});a.events.on("commands.before",function(f){(f=FroalaEditor.COMMANDS[f])&&("undefined"==typeof f.focus||
f.focus)&&XF.EditorHelpers.restoreMaintainedSelection(a)})},restoreMaintainedSelection(a){const b=a.$el.data("xf-ed-blur-sel");a.selection.inEditor()||(b?(a.markers.remove(),a.markers.place(b,!0,0),a.markers.place(b,!1,0)):a.selection.setAtEnd(a.el),a.selection.restore())},focus(a){XF.EditorHelpers.restoreMaintainedSelection(a);a.$tb.addClass("is-focused");a.events.focus()},blur(a){a.$el[0].blur();a.$tb.removeClass("is-focused");a.selection.clear()},sync(a){a.$oel.val(a.html.get())},wrapSelectionText(a,
b,e,d,c){d&&a.selection.save();a.undo.saveStep();d=u.createElement("div");var f=Array.from(a.el.querySelectorAll(".fr-marker")),g=null;if(a.selection.isCollapsed())d.appendChild(f[0]),d.appendChild(f[f.length-1]),f=d.innerHTML;else if(d.appendChild(f[f.length-1]),f=XF.EditorHelpers.bypassBrowserShims(a,()=>a.html.getSelected()),/<p>/i.test(f))if(c){g=u.createElement("div");g.innerHTML=f;const n=g.querySelector("p");n.insertAdjacentHTML("afterbegin",XF.htmlspecialchars(b));n.append(...Array.from(d.children));
n.insertAdjacentHTML("beforeend",XF.htmlspecialchars(e));g=1===g.children.length&&1===g.children[0].children.length?n.innerHTML:g.innerHTML}else f+=d.innerHTML,c=!0;else f+=d.innerHTML;null===g&&(g=XF.htmlspecialchars(b)+f+XF.htmlspecialchars(e));c||(g="<p>"+g+"</p>");a.html.insert(g);a.selection.restore();a.placeholder.hide();a.undo.saveStep();XF.EditorHelpers.normalizeAfterInsert(a)},insertCode(a,b,e){let d;switch(b.toLowerCase()){case "":d="CODE";b="";break;default:d="CODE",b=b.toLowerCase()}e=
e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\t/g,"    ").replace(/\n /g,"\n&nbsp;").replace(/ {2}/g,"&nbsp; ").replace(/ {2}/g," &nbsp;").replace(/\n/g,"</p><p>");e="["+d+(b?"="+b:"")+"]"+e+"[/"+d+"]";e.match(/<\/p>/i)&&(e=("<p>"+e+"</p>").replace(/<p><\/p>/g,"<p><br></p>"));a.undo.saveStep();a.html.insert(e);a.undo.saveStep();XF.EditorHelpers.normalizeAfterInsert(a)},insertSpoiler(a,b){XF.EditorHelpers.wrapSelectionText(a,b?'[SPOILER="'+b+'"]':
"[SPOILER]","[/SPOILER]",!0)},normalizeBrForEditor(a){const b="string"===typeof a;let e;b?(e=XF.createElementFromString("<div></div>"),e.innerHTML=a):e=a;const d=(c,f)=>c.nodeType!==Node.ELEMENT_NODE?!1:c.matches(f)&&""===c.className&&!c.hasAttribute("id")&&!c.hasAttribute("style");Array.from(e.childNodes).forEach(c=>{if(c.nodeType===Node.ELEMENT_NODE&&c.matches("p")&&1===c.childNodes.length){var f=c.childNodes[0];d(f,"span")&&(c.innerHTML=f.innerHTML)}});Array.from(e.childNodes).forEach(c=>{if(c.nodeType===
Node.ELEMENT_NODE&&c.matches("p")&&!(1>=c.childNodes.length)&&d(c.childNodes[0],"br")){const f=c.parentNode,g=c.firstChild,n=u.createElement("p");n.appendChild(g);f.insertBefore(n,c)}});Array.from(e.childNodes).forEach(c=>{c.nodeType!==Node.ELEMENT_NODE||!c.matches("p")||1>=c.childNodes.length||(c=c.childNodes[c.childNodes.length-1],d(c,"br")&&c.remove())});return b?e.innerHTML:e},normalizeAfterInsert(a){const b=a.html.getSelected();/<br>\s*<\/p>/.test(b)&&(XF.EditorHelpers.normalizeBrForEditor(a.$el[0]),
a.undo_index--,a.undo_stack.pop(),a.undo.saveStep())},isPreviewAvailable(a){return a.dataset.previewUrl||a.closest("form").dataset.previewUrl?!0:!1},dialogs:{},loadDialog(a,b){const e=XF.EditorHelpers.dialogs;e[b]?e[b].show(a):console.error("Unknown dialog '"+b+"'")},bypassBrowserShims(a,b,e=["mozilla"]){const d={};for(const c of e)d[c]=a.browser[c],a.browser[c]=0;try{return b()}finally{for(const c of Object.keys(d))a.browser[c]=d[c]}}};XF.EditorDialog=XF.create({ed:null,overlay:null,dialog:null,
cache:!0,__construct(a){this.dialog=a},show(a){this.ed=a;a.selection.save();XF.loadOverlay(XF.canonicalizeUrl("index.php?editor/dialog&dialog="+this.dialog),{beforeShow:this.beforeShow.bind(this),afterShow:this.afterShow.bind(this),init:this.init.bind(this),cache:this.cache})},init(a){a.on("overlay:hidden",()=>{this.ed&&this.ed.markers.remove()});this._init(a)},_init(a){},beforeShow(a){this.overlay=a;this._beforeShow(a)},_beforeShow(a){},afterShow(a){this._afterShow(a);a.overlay.querySelector("textarea, input").focus()},
_afterShow(a){}});XF.EditorDialogMedia=XF.extend(XF.EditorDialog,{_beforeShow(a){u.querySelector("#editor_media_url").value=""},_init(a){XF.on(u.querySelector("#editor_media_form"),"submit",this.submit.bind(this))},submit(a){a.preventDefault();const b=this.ed,e=this.overlay;XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/media"),{url:u.querySelector("#editor_media_url").value},d=>{d.matchBbCode?(b.selection.restore(),b.undo.saveStep(),b.html.insert(XF.htmlspecialchars(d.matchBbCode)),b.undo.saveStep(),
XF.EditorHelpers.normalizeAfterInsert(b),e.hide()):d.noMatch?XF.alert(d.noMatch):(b.selection.restore(),e.hide())})}});XF.EditorDialogSpoiler=XF.extend(XF.EditorDialog,{_beforeShow(a){u.querySelector("#editor_spoiler_title").value=""},_init(a){XF.on(u.querySelector("#editor_spoiler_form"),"submit",this.submit.bind(this))},submit(a){a.preventDefault();a=this.ed;const b=this.overlay;a.selection.restore();XF.EditorHelpers.insertSpoiler(a,u.querySelector("#editor_spoiler_title").value);b.hide()}});XF.EditorDialogCode=
XF.extend(XF.EditorDialog,{_beforeShow(a){this.ed.$el.blur()},_afterShow(a){a=a.container;var b=a.querySelector(".CodeMirror");const e=this.ed;const d=a.querySelector('[data-xf-init~="code-editor-switcher-container"]');XF.trigger(d,"code-editor:reinit");if(b)var c=b.CodeMirror;e.selection.isCollapsed()?b="":(b=e.html.getSelected().replace(/&nbsp;/gmi," ").replace(/\u200B/g,"").replace(/(<\/(p|div|pre|blockquote|h[1-6]|tr|th|ul|ol|li)>)\s*/gi,"$1\n").replace(/<(li|p)><br><\/\1>\s*/gi,"\n").replace(/<br>\s*/gi,
"\n"),b=u.createRange().createContextualFragment(b).firstChild.textContent.trim());e.selection.save();c?(c.getDoc().setValue(b),c.focus()):(c=a.querySelector(".js-codeEditor"),c.value=b,c.focus())},_init(a){XF.on(u.querySelector("#editor_code_form"),"submit",this.submit.bind(this))},submit(a){a.preventDefault();a=this.ed;const b=this.overlay;var e=b.container.querySelector(".CodeMirror");if(e){e=e.CodeMirror;var d=e.getDoc();e.save();d.setValue("");e.setOption("mode","")}e=u.querySelector("#editor_code_type");
d=u.querySelector("#editor_code_code");a.selection.restore();XF.EditorHelpers.insertCode(a,e.value,d.value);b.hide();d.value="";e.value=""}});XF.editorStart={started:!1,custom:[],startAll(){XF.editorStart.started||(XF.editorStart.setupLanguage(),XF.editorStart.registerOverrides(),XF.editorStart.registerToolbarSizes(),XF.editorStart.registerCommands(),XF.editorStart.registerCustomCommands(),XF.editorStart.registerEditorDropdowns(),XF.editorStart.registerDialogs(),XF.trigger(u,"editor:first-start"),
XF.editorStart.started=!0)},setupLanguage(){const a=XF.isRtl()?"rtl":"ltr";let b;try{b=JSON.parse(u.querySelector(".js-editorLanguage").innerHTML)||{}}catch(e){console.error(e),b={}}FroalaEditor.LANGUAGE.xf={translation:b,direction:a?a.toLowerCase():"ltr"}},registerOverrides(){const a=FroalaEditor.MODULES.helpers;FroalaEditor.MODULES.helpers=function(b,...e){e=a.apply(this,[b,...e]);const d=e.sanitizeURL;e.sanitizeURL=function(c){return d(c).replace(/["]/g,"%22").replace(/[']/g,"%27")};e.screenSize=
function(){function c(g,n){b.$box.data("size",n);return FroalaEditor[XF.hasOwn(FroalaEditor,n)?n:"LG"]}let f;try{f=b.$box.width();const g=XF.EditorHelpers.toolbarSizes;if(0>=f){let n=b.$box[0];for(;n=n.parentNode;)if(f=n.clientWidth,0<f){const k=C.getComputedStyle(n);f-=parseInt(k.paddingLeft,10)+parseInt(k.paddingRight,10);if(0<f)break}}return f<g.SM?c(f,"XS"):f<g.MD?c(f,"SM"):f<g.LG?c(f,"MD"):f<g.LG+50?c(f,"LG"):c(f,"XL")}catch(g){return c(f,"XS")}};return e}},registerToolbarSizes(){let a;try{a=
JSON.parse(u.querySelector(".js-editorToolbarSizes").innerHTML)||{}}catch(b){console.error("Toolbar sizes data not valid: ",b);return}XF.EditorHelpers.toolbarSizes=a},commands:{xfQuote:["quote-right",{title:"Quote",icon:"xfQuote",undo:!0,focus:!0,callback(){this.selection.save();this.html.wrap(!0,!0,!0,!0);this.selection.restore();var a=this.selection.blocks();const b=[];let e=!0,d;var c;1==a.length&&a[0].matches(".fr-temp-div")&&(a=[this.$el.find("p").get(0)]);for(d=0;d<a.length;d++){const f=c=a[d];
let g=null;for("BLOCKQUOTE"==c.tagName&&(g=c);c.parentNode&&c.parentNode!==this.el;)c=c.parentNode,g||"BLOCKQUOTE"!=c.tagName||(g=c);c={original:f,quote:g,root:c};c.quote&&(e=!1);b.push(c)}this.selection.save();if(e)for(a=u.createElement("blockquote"),b[0].root.parentNode.insertBefore(a,b[0].root),d=0;d<b.length;d++)a.append(b[d].root);else for(d=0;d<b.length;d++)if(a=b[d].quote)a.outerHTML=a.innerHTML;this.html.unwrap();this.selection.restore()}}],xfCode:["code",{title:"Code",icon:"xfCode",undo:!0,
focus:!0,callback(){XF.EditorHelpers.loadDialog(this,"code")}}],xfInlineCode:["terminal",{title:"Inline Code",icon:"xfInlineCode",undo:!0,focus:!0,refresh:function(a){const b=this.format.is("code");a.toggleClass("fr-active",b).attr("aria-pressed",b)},callback(){this.format.toggle("code")}}],xfMedia:["photo-video",{title:"Media",icon:"xfMedia",undo:!0,focus:!0,callback(){XF.EditorHelpers.loadDialog(this,"media")}}],xfSpoiler:["eye-slash",{title:"Spoiler",icon:"xfSpoiler",undo:!0,focus:!0,callback(){XF.EditorHelpers.loadDialog(this,
"spoiler")}}],xfInlineSpoiler:["mask",{title:"Inline Spoiler",icon:"xfInlineSpoiler",undo:!0,focus:!0,callback(){XF.EditorHelpers.wrapSelectionText(this,"[ISPOILER]","[/ISPOILER]",!0,!0)}}],xfSmilie:["smile",{title:"Smilies",icon:"xfSmilie",undo:!1,focus:!1,refreshOnCallback:!1,callback(){setTimeout(()=>this.xfSmilie.showMenu(),0)}}],xfInsertGif:["xfInsertGif",{title:"Insert GIF",icon:"xfInsertGif",undo:!1,focus:!1,refreshOnCallback:!1,callback(){setTimeout(()=>this.xfInsertGif.showMenu(),0)}}],xfDraft:["save",
{type:"dropdown",title:"Drafts",focus:!0,undo:!1,options:{xfDraftSave:"Save Draft",xfDraftDelete:"Delete Draft"},html(){const a={xfDraftSave:"Save Draft",xfDraftDelete:"Delete Draft"};let b='<ul class="fr-dropdown-list">';for(const e in a)b+='<li><a class="fr-command" data-cmd="xfDraft" data-param1="'+e+'">'+this.language.translate(a[e])+"</a></li>";return b+"</ul>"},callback(a,b){(a=this.$el[0].closest("form"))?(a=XF.Element.getHandler(a,"draft"))?"xfDraftSave"==b?a.triggerSave():"xfDraftDelete"==
b&&a.triggerDelete():console.error("No draft handler on parent form"):console.error("No parent form to find draft handler")}}],xfBbCode:["brackets",{title:"Toggle BB Code",icon:"xfBbCode",undo:!1,focus:!1,forcedRefresh:!0,callback(){this.bbCode.toggle()}}],xfPreview:["file-search",{title:"Preview",icon:"xfPreview",undo:!1,focus:!1,forcedRefresh:!0,callback(){this.contentPreview.toggle()}}]},registerCommands(){let a;FroalaEditor.PLUGINS.xfInsertGif=function(b){function e(){const h=new IntersectionObserver(c,
{root:w,rootMargin:"0px 0px 100px 0px"});w.querySelectorAll(".js-gif img:not(.js-observed)").forEach(r=>{r.classList.add("js-observed");h.observe(r)});const t=new IntersectionObserver(f,{root:w,rootMargin:"0px 0px 50px 0px"});w.querySelectorAll(".js-gifLoadMore").forEach(r=>{t.observe(r)});w.querySelectorAll(".js-gif").forEach(r=>XF.on(r,"click",d))}function d(h){h=h.currentTarget.querySelector("img");const t=h.parentNode;if(!t.classList.contains("is-loading")){t.classList.add("is-loading");var r=
h.dataset.insert,v=u.createElement("img");v.setAttribute("src",r);v.classList.add("fr-fic","fr-dii","fr-draggable");v.alt=h.alt;h=function(){b.selection.restore();XF.EditorHelpers.focus(b);b.undo.saveStep();b.html.insert(v.outerHTML);b.undo.saveStep();b.selection.save();XF.EditorHelpers.blur(b);XF.EditorHelpers.normalizeAfterInsert(b);q&&q.querySelector(".js-gifCloser").click();t.classList.remove("is-loading")};if(v.complete)h();else XF.on(v,"load",h)}}function c(h,t){for(const r of h)if(h=r.target,
r.isIntersecting)k(h);else a:{if(!h.dataset.loaded)break a;t=h.getAttribute("data-src");const v=h.getAttribute("src");h.setAttribute("src",t);h.setAttribute("data-src",v);h.dataset.loaded=""}}function f(h,t){for(const r of h)r.isIntersecting&&(h=r.target,n(h),t.unobserve(r.target))}function g(h){let t=h;h instanceof Event&&(t=h.target);if(t.offsetParent){var r=t.getBoundingClientRect(),v=r.bottom+100;t.childNodes.forEach(z=>{if(z.nodeType===Node.ELEMENT_NODE){var y=z.getBoundingClientRect();if(!(y.bottom<
r.top)){if(y.top>v)return!1;z.querySelectorAll(".js-gif img").forEach(B=>{B.getBoundingClientRect().top<=v&&k(B)})}}})}}function n(h){h.dataset.loading||(h.dataset.loading="1",XF.ajax("GET",h.dataset.href,t=>{t.html&&XF.setupHtmlInsert(t.html,r=>{const v=(r.matches(".js-gifContainer")?r:r.querySelector(".js-gifContainer")).closest(".js-gifContainer");setTimeout(()=>{h.outerHTML=v.innerHTML;e()},100)})}))}function k(h){if(!h.dataset.loaded){var t=h.getAttribute("data-src"),r=h.getAttribute("src");
h.setAttribute("src",t);h.setAttribute("data-src",r);h.dataset.loaded="1"}}function l(){const h=this,t=q.querySelector(".js-gifFullRow"),r=q.querySelector(".js-gifSearchRow");clearTimeout(A);A=setTimeout(function(){const v=h.value;if(!v||2>v.length)XF.display(r,"none"),XF.display(t),g(t);else{var z=XF.canonicalizeUrl("index.php?editor/insert-gif/search");XF.ajax("GET",z,{q:v},y=>{y.html&&XF.setupHtmlInsert(y.html,B=>{XF.display(t,"none");r.innerHTML=B.outerHTML;XF.display(r);w.scroll({top:0});e()})})}},
300)}let m=!1,p=!1,q,w,x=0,A;return{showMenu:function(){b.selection.save();XF.EditorHelpers.blur(b);var h=b.$tb.find('.fr-command[data-cmd="xfInsertGif"]')[0];if(!m){m=!0;let t=u.querySelector(".js-xfEditorMenu").innerHTML.trim();t=Mustache.render(t,{href:XF.canonicalizeUrl("index.php?editor/insert-gif")});q=u.createRange().createContextualFragment(t).querySelector(".menu");q.classList.add("menu--gif");h.insertAdjacentElement("afterend",q);h.dataset.xfClick="menu";const r=XF.Event.getElementHandler(h,
"menu","click");XF.on(h,"menu:complete",()=>{w=q.querySelector(".menu-scroller");if(!p){p=!0;e();const v=q.querySelector(".js-gifSearch");XF.on(v,"input",l);XF.on(q.querySelector(".js-gifCloser"),"click",()=>XF.EditorHelpers.focus(b));b.events.on("commands.mousedown",z=>{"xfInsertGif"!=z.data("cmd")&&r.close()});XF.on(q,"menu:closed",()=>{x=w.scrollTop})}w.scroll({top:x})});XF.on(q,"menu:closed",()=>{setTimeout(()=>{b.markers.remove()},50)})}(h=XF.DataStore.get(h,"xf-click-handlers"))&&h.menu&&h.menu.toggle()}}};
FroalaEditor.PLUGINS.xfSmilie=function(b){function e(h){const t=h.currentTarget,r=t.innerHTML;if(!t.classList.contains("smilie--lazyLoad")){XF.EditorHelpers.bypassBrowserShims(b,()=>{b.selection.restore();XF.EditorHelpers.focus(b);b.undo.saveStep();b.html.insert(r);b.undo.saveStep();b.selection.save();XF.EditorHelpers.blur(b);XF.EditorHelpers.normalizeAfterInsert(b)});if(m){const v=m.querySelector(".js-emojiInsertedRow");v.querySelector(".js-emojiInsert").innerHTML=r;XF.Transition.addClassTransitioned(v,
"is-active");clearTimeout(w);w=setTimeout(()=>XF.Transition.removeClassTransitioned(v,"is-active"),1500)}clearTimeout(x);x=setTimeout(()=>XF.logRecentEmojiUsage(t.dataset.shortname),1500)}}function d(h,t){for(const r of h)r.isIntersecting&&(h=r.target,f(h),t.unobserve(r.target))}function c(h,t){let r=h;h instanceof Event&&(r=h.target);if(t||r.offsetParent){var v=r.getBoundingClientRect(),z=v.bottom+100;r.childNodes.forEach(y=>{if(y.nodeType===Node.ELEMENT_NODE){var B=y.getBoundingClientRect();if(!(B.bottom<
v.top)){if(B.top>z)return!1;y.querySelectorAll("span.smilie--lazyLoad").forEach(D=>{D.getBoundingClientRect().top<=z&&f(D)})}}})}}function f(h){const t=XF.createElement("img",{className:h.getAttribute("class").replace(/(\s|^)smilie--lazyLoad(\s|$)/," "),alt:h.getAttribute("data-alt"),title:h.getAttribute("title"),src:h.getAttribute("data-src"),dataset:{shortname:h.dataset.shortname}}),r=()=>{C.requestAnimationFrame(()=>{h.outerHTML=t.outerHTML})};if(t.complete)XF.on(t,"load",r);else r()}function g(){const h=
this,t=m.querySelector(".js-emojiFullList"),r=m.querySelector(".js-emojiSearchResults");clearTimeout(A);A=setTimeout(()=>{const v=h.value;if(!v||2>v.length)XF.display(r,"none"),XF.display(t),c(t);else{var z=XF.canonicalizeUrl("index.php?editor/smilies-emoji/search");XF.ajax("GET",z,{q:v},y=>{y.html&&XF.setupHtmlInsert(y.html,B=>{XF.display(t,"none");r.innerHTML=B.outerHTML;XF.display(r);r.querySelectorAll(".js-emoji").forEach(D=>{XF.on(D,"click",e)})})})}},300)}function n(){let h;const t=XF.getRecentEmojiUsage(),
r=p.querySelector(".js-recentHeader"),v=p.querySelector(".js-recentBlock"),z=v.querySelector(".js-recentList"),y=p.querySelectorAll(".js-emojiList");if(t){var B=z.cloneNode(!0),D=[];B.innerHTML="";for(h in t){const F=t[h];y.forEach(E=>{if(E=E.querySelector(`.js-emoji[data-shortname="${F}"]`))return E=E.closest("li").cloneNode(!0),D.push(E),!1})}for(h in D)B.appendChild(D[h]);z.innerHTML=B.innerHTML;z.querySelectorAll(".js-emoji").forEach(F=>{XF.on(F,"click",e)});v.classList.contains("is-hidden")&&
(XF.display(v,"none"),v.classList.remove("is-hidden"),r.classList.remove("is-hidden"),XF.Animate.fadeDown(v,{speed:XF.config.speed.fast}));c(z,!0)}}let k=!1,l=!1,m,p,q=0,w,x,A;return{showMenu:function(){b.selection.save();XF.EditorHelpers.blur(b);var h=b.$tb.find('.fr-command[data-cmd="xfSmilie"]')[0];if(!k){k=!0;let t=u.querySelector(".js-xfEditorMenu").innerHTML.trim();t=Mustache.render(t,{href:XF.canonicalizeUrl("index.php?editor/smilies-emoji")});m=u.createRange().createContextualFragment(t).querySelector(".menu");
m.classList.add("menu--emoji");h.insertAdjacentElement("afterend",m);h.dataset.xfClick="menu";const r=XF.Event.getElementHandler(h,"menu","click");XF.on(h,"menu:complete",()=>{p=m.querySelector(".menu-scroller");if(!l){l=!0;const v=new IntersectionObserver(d,{root:p,rootMargin:"0px 0px 100px 0px"});p.querySelectorAll("span.smilie--lazyLoad").forEach(y=>{v.observe(y)});p.querySelectorAll(".js-emoji").forEach(y=>XF.on(y,"click",e));const z=m.querySelector(".js-emojiSearch");XF.on(z,"input",g);XF.on(m.querySelector(".js-emojiCloser"),
"click",()=>XF.EditorHelpers.focus(b));XF.on(u,"recent-emoji:logged",n);b.events.on("commands.mousedown",y=>{"xfSmilie"!=y.data("cmd")&&r.close()});XF.on(m,"menu:closed",()=>{q=p.scrollTop})}p.scroll({top:q})});XF.on(m,"menu:closed",()=>setTimeout(()=>b.markers.remove(),50))}(h=XF.DataStore.get(h,"xf-click-handlers"))&&h.menu&&h.menu.toggle()}}};XF.extendObject(FroalaEditor.DEFAULTS,{xfBbCodeAttachmentContextInput:"attachment_hash_combined"});FroalaEditor.PLUGINS.bbCode=function(b){function e(){return b.$tb.find(".fr-command[data-cmd=xfBbCode]")[0]}
function d(){const k=b.$oel;let l=k.data("xfBbCodeBox");if(!l){const m=parseInt(b.$wp.css("border-bottom-width"),10)+parseInt(b.$wp.css("border-top-width"),10);l=XF.createElementFromString('<textarea class="input" style="display: none"></textarea>');l.setAttribute("aria-label",XF.htmlspecialchars(XF.phrase("rich_text_box")));Object.assign(l.style,{minHeight:b.opts.heightMin?b.opts.heightMin+m+"px":null,maxHeight:b.opts.heightMax?b.opts.heightMax+"px":null,height:b.opts.height?b.opts.height+m+"px":
null,padding:b.$el.css("padding")});l.setAttribute("name",k.data("original-name"));k.data("xfBbCodeBox",l);b.$wp.after(l);XF.on(l,"focus",p=>b.$box.addClass("is-focused"));XF.on(l,"blur",p=>b.$box.removeClass("is-focused"));setTimeout(()=>{XF.Element.applyHandler(l,"textarea-handler");XF.Element.applyHandler(l,"user-mentioner");XF.Element.applyHandler(l,"emoji-completer");XF.isElementWithinDraftForm(l)&&XF.Element.applyHandler(l,"draft-trigger")},100)}return l}function c(k){return Array.from(b.$tb[0].querySelectorAll(".fr-btn-grp .fr-command, .fr-more-toolbar .fr-command")).filter(l=>
!l.isSameNode(k)&&!l.getAttribute("data-cmd").startsWith("more")&&"xfPreview"!==l.getAttribute("data-cmd"))}function f(k,l){const m=d(),p=function(q,w){n=!0;let x;b.undo.saveStep();b.$el.blur();x=e();c(x).forEach(A=>A.classList.add("fr-disabled"));x.classList.add("fr-active");b.$wp.css("display","none");b.$oel.attr("disabled","disabled");m.value=q;XF.display(m);m.disabled=!1;XF.trigger(m,"autosize");w||m.focus();XF.setIsEditorEnabled(!1)};"string"==typeof k?p(k,l):XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-bb-code"),
{html:b.html.get()},function(q){p(q.bbCode,l)})}function g(k){const l=d(),m=function(p){n=!1;const q=e();c(q).forEach(w=>w.classList.remove("fr-disabled"));q.classList.remove("fr-active");b.$oel.removeAttr("disabled");b.html.set(p);XF.display(l,"none");l.disabled=!0;b.$wp.css("display","");b.events.focus();b.undo.saveStep();b.size.refresh();XF.setIsEditorEnabled(!0);XF.layoutChange()};if("string"==typeof k)m(k);else{k={bb_code:l.value};const p=b.$el[0].closest("form");p&&p[b.opts.xfBbCodeAttachmentContextInput]&&
(k.attachment_hash_combined=p[b.opts.xfBbCodeAttachmentContextInput].value);XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-html"),k,function(q){m(q.editorHtml)})}}let n=!1;return{_init:function(){b.events.on("buttons.refresh",function(){return!n})},getBbCodeBox:d,toBbCode:f,isBbCodeView:function(){return n},getTextArea:function(){return n?d():null},insertBbCode:function(k){if(n){var l=d();XF.insertIntoTextBox(l,k)}},replaceBbCode:function(k){if(n){var l=d();XF.replaceIntoTextBox(l,k)}},toHtml:g,
toggle:function(){n?g():f()},getToggleableButtons:function(){return c(e())}}};FroalaEditor.PLUGINS.contentPreview=function(b){function e(){return b.$tb.find(".fr-command[data-cmd=xfPreview]")[0]}function d(){const m=b.$oel;var p=m.data("xfPreviewBox");if(!p){p=C.getComputedStyle(b.$el[0]);const q={paddingTop:p.paddingTop,paddingRight:p.paddingRight,paddingBottom:p.paddingBottom,paddingLeft:p.paddingLeft,minHeight:b.opts.heightMin?b.opts.heightMin+"px":null};p=XF.createElementFromString('<div class="xfPreview" style="display:none"></div>');
Object.assign(p.style,q);m.data("xfPreviewBox",p);b.$wp.after(p)}return p}function c(m){const p=b.$tb[0].querySelectorAll(".fr-btn-grp .fr-command");return Array.from(p).filter(q=>q!==m)}function f(m){const p=d(),q=function(x){l=!0;b.undo.saveStep();b.$el.blur();b.$tb.find('.fr-command.fr-open[data-cmd^="more"]').each(function(){b.commands.exec(this.getAttribute("data-cmd"))});var A=e();c(A).forEach(h=>{h.classList.add("fr-disabled","fr-invisible")});A.classList.add("fr-active");b.$tb.find(".fr-btn-grp").addClass("rte-tab--inactive").filter(".rte-tab--preview").removeClass("rte-tab--inactive");
b.$box.addClass("is-preview");b.bbCode.isBbCodeView()?(A=b.bbCode.getBbCodeBox(),XF.display(A,"none")):b.$wp.css("display","none");p.innerHTML=x.querySelector(".bbWrapper").innerHTML;XF.display(p)};if("string"==typeof m)m=u.createRange().createContextualFragment(m),q(m.firstChild);else{b.events.trigger("form.submit");var w=b.$oel.closest("form")[0];m=b.$oel.data("preview-url")?b.$oel.data("preview-url"):w.dataset.previewUrl;w=XF.getDefaultFormData(w);XF.ajax("POST",XF.canonicalizeUrl(m),w,x=>{XF.setupHtmlInsert(x.html,
A=>{XF.activate(A);q(A)})})}}function g(m){var p=d();const q=e(),w=b.bbCode.isBbCodeView();l=!1;c(q).forEach(x=>x.classList.remove("fr-disabled","fr-invisible"));q&&q.classList.remove("fr-active");w&&b.bbCode.getToggleableButtons().forEach(x=>x.classList.add("fr-disabled"));b.$tb.find(".fr-btn-grp").removeClass("rte-tab--inactive").filter(".rte-tab--preview").addClass("rte-tab--inactive");b.$oel.removeAttr("disabled");XF.display(p,"none");b.$box.removeClass("is-preview");w?(p=b.bbCode.getBbCodeBox(),
XF.display(p)):b.$wp.css("display","");m||b.events.focus();XF.layoutChange()}function n(){const m=b.$oel[0];XF.EditorHelpers.isPreviewAvailable(m)&&(l?g():(XF.EditorHelpers.sync(b),(b.bbCode&&b.bbCode.isBbCodeView()?b.bbCode.getBbCodeBox().value:m.value)&&f()))}function k(){const m=b.$tb.find(".fr-btn-grp");XF.EditorHelpers.isPreviewAvailable(b.$oel[0])?(m.slice(m.length-1).addClass("rte-tab--inactive rte-tab--preview"),m.slice(m.length-2,m.length-1).addClass("rte-tab--beforePreview")):m.slice(m.length-
1).addClass("rte-tab--beforePreview")}let l=!1;return{_init:function(){b.events.on("buttons.refresh",function(){return!l});k();b.events.on("codeView.toggle",function(){k()});b.$tb.on("click",function(m){l&&(m.target.closest(".rte-tab--preview")||n())});XF.on(b.$tb[0].closest("form"),"preview:hide",function(){g(!0)})},toPreview:f,isPreview:function(){return l},toHtml:g,toggle:n}};for(a of Object.keys(this.commands))FroalaEditor.DefineIcon(a,{NAME:this.commands[a][0]}),FroalaEditor.RegisterCommand(a,
this.commands[a][1])},registerCustomCommands(){let a;try{a=JSON.parse(u.querySelector(".js-editorCustom").innerHTML)||{}}catch(b){console.error(b),a={}}for(const b of Object.keys(a))(function(e,d){const c="xfCustom_"+e,f=e.toUpperCase();e={};if("fa"==d.type)if(e=d.value.match(/^(?:(fa(?:[lrsdb]))\s)?fa-(.+)$/)){var g;const n=null!=(g=e[1])?g:"fa";e={FA5NAME:e[2],template:`${n}_svg`}}else e={NAME:d.value};else"svg"==d.type?e={template:"svg",PATH:d.value}:"image"==d.type&&(e={template:"image",SRC:'"'+
XF.canonicalizeUrl(d.value)+'"',ALT:'"'+d.title+'"'});g={title:d.title,icon:c,undo:!0,focus:!0,callback(){XF.EditorHelpers.wrapSelectionText(this,"yes"==d.option?"["+f+"=]":"["+f+"]","[/"+f+"]",!0)}};FroalaEditor.DefineIcon(c,e);FroalaEditor.RegisterCommand(c,g);XF.editorStart.custom.push(c)})(b,a[b]);FroalaEditor.DefineIcon("xfInsertGif",{template:"svg",PATH:"M11.5 9H13v6h-1.5zM9 9H6c-.6 0-1 .5-1 1v4c0 .5.4 1 1 1h3c.6 0 1-.5 1-1v-2H8.5v1.5h-2v-3H10V10c0-.5-.4-1-1-1zm10 1.5V9h-4.5v6H16v-2h2v-1.5h-2v-1z"});
FroalaEditor.DefineIcon("textColor",{NAME:"palette"});FroalaEditor.DefineIcon("fontFamily",{NAME:"font"});FroalaEditor.DefineIcon("fontSize",{NAME:"text-size"});FroalaEditor.DefineIcon("tableColumns",{NAME:"line-columns"});FroalaEditor.DefineIcon("insertHR",{NAME:"horizontal-rule"})},registerEditorDropdowns(){let a;try{a=JSON.parse(u.querySelector(".js-editorDropdowns").innerHTML)||{}}catch(b){console.error("Editor dropdowns data not valid: ",b),a={}}for(const b of Object.keys(a))(function(e,d){d.icon=
d.icon.substr(3);FroalaEditor.DefineIcon(e,{NAME:d.icon});FroalaEditor.RegisterCommand(e,{type:"dropdown",title:d.title,icon:e,undo:!1,focus:!1,html(){let c='<ul class="fr-dropdown-list">',f=d.buttons;var g;let n;(g=XF.getEditorInContainer(this.$oel[0]))&&g.buttonManager&&(f=g.buttonManager.getDropdown(e));for(const k in f)g=f[k],(n=FroalaEditor.COMMANDS[g])&&(c+='<li><a class="fr-command" data-cmd="'+g+'">'+this.icon.create(n.icon||g)+"&nbsp;&nbsp;"+this.language.translate(n.title)+"</a></li>");
return c+"</ul>"}})})(b,a[b])},registerDialogs(){XF.EditorHelpers.dialogs.media=new XF.EditorDialogMedia("media");XF.EditorHelpers.dialogs.spoiler=new XF.EditorDialogSpoiler("spoiler");XF.EditorHelpers.dialogs.code=new XF.EditorDialogCode("code")}};XF.on(u,"editor:start",XF.editorStart.startAll,{once:!0});XF.EditorPlaceholderClick=XF.Event.newHandler({eventNameSpace:"XFEditorPlaceholderClick",options:{},edInitialized:!1,init(){},click(a){a=this.target;const b=this;a.querySelector(".editorPlaceholder-editor").classList.remove("is-hidden");
a.querySelector(".editorPlaceholder-placeholder").classList.add("is-hidden");a=XF.getEditorInContainer(a);a instanceof XF.Editor?this.edInitialized||a.startInit({beforeInit(){b.edInitialized=!0},afterInit(e,d){d.events.focus(!0);XF.isIOS()&&(e.scrollToCursor(),e.scrollToCursorAfterPendingResize());d.opts.tooltips&&setTimeout(()=>{d.tooltip.hide()},30)}}):a instanceof Element&&a.focus()}});XF.Event.register("click","editor-placeholder","XF.EditorPlaceholderClick");XF.Element.register("editor","XF.Editor")})(window,
document);
