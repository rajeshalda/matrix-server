((h,e)=>{XF.CodeEditor=XF.Element.newHandler({options:{indentUnit:4,indentWithTabs:!0,lineNumbers:!0,lineWrapping:!1,autoCloseBrackets:!0,autoCloseTags:null,mode:null,config:null,submitSelector:null,scrollbarStyle:"simple"},editor:null,wrapper:null,init(){if(this.isAdvancedEditorSupported())if(this.target.parentNode.scrollHeight)this.initEditor();else XF.oneWithin(this.target,"toggle:shown overlay:showing tab:shown",this.initEditor.bind(this));else XF.display(this.target)},isAdvancedEditorSupported(){return"android"!==
XF.browser.os},initEditor(){const a=this.target;var b={},c={};if(!a.dataset.cmInitialized){try{c=JSON.parse(this.options.config)}catch(d){c=this.options.config}try{b=JSON.parse(e.querySelector(".js-codeEditorLanguage").innerHTML)||{}}catch(d){console.error(d),b={}}c=XF.extendObject({mode:this.options.mode,indentUnit:this.options.indentUnit,indentWithTabs:this.options.indentWithTabs,lineNumbers:this.options.lineNumbers,lineWrapping:this.options.lineWrapping,autoCloseBrackets:this.options.autoCloseBrackets,
readOnly:a.readOnly,autofocus:a.autofocus,scrollbarStyle:this.options.scrollbarStyle,phrases:b},c);b=this.options.autoCloseTags;null!==b&&(c.autoCloseTags=b?!0:!1);this.editor=CodeMirror.fromTextArea(a,c);this.wrapper=this.editor.getWrapperElement();c=a.className.split(" ").filter(d=>""!==d);c=c.filter(d=>!d.match(/(^| )input(--[^ ]+)?(?= |$)/g));b=this.wrapper.className.split(" ").filter(d=>""!==d);c=[...(new Set([...b,...c]))];this.wrapper.className=c.join(" ");a.className="";this.wrapper.setAttribute("dir",
"ltr");this.editor.refresh();XF.layoutChange();this.editor.on("keydown",this.keydown.bind(this));c=a.closest("form");XF.on(c,"ajax-submit:before",this.onSubmit.bind(this));c=XF.customEvent("code-editor:init",{editor:this.editor});XF.trigger(a,c);a.dataset.cmInitialized="1"}},onSubmit(a){this.editor.save()},keydown(a,b){if(XF.isMac()&&b.metaKey&&b.ctrlKey&&"f"==b.key||!XF.isMac()&&"F11"==b.key)b.preventDefault(),a.setOption("fullScreen",!a.getOption("fullScreen"));"Escape"==b.key&&(b.stopPropagation(),
a.getOption("fullScreen")&&a.setOption("fullScreen",!1));if(("s"==b.key||"Enter"==b.key)&&(XF.isMac()?b.metaKey:b.ctrlKey)){b.preventDefault();a=a.getTextArea().closest("form");b=this.options.submitSelector;const c=a.querySelector(b);b&&c?c.click():XF.trigger(a,"submit")&&a.submit()}}});XF.CodeEditorSwitcherContainer=XF.Element.newHandler({options:{switcher:".js-codeEditorSwitcher",templateSuffixMode:0},switcher:null,editor:null,loading:!1,init(){XF.on(this.target,"code-editor:init",this.initEditor.bind(this));
XF.on(this.target,"code-editor:reinit",this.change.bind(this))},initEditor(a){({editor:a}=a);const b=this.target.querySelector(this.options.switcher);if(b){this.switcher=b;var c=b.tagName.toLowerCase(),d=b.getAttribute("type");if("select"===c||"radio"===d)XF.on(b,"change",this.change.bind(this));else if("input"===c&&"checkbox"!==d&&"radio"!==d)XF.on(b,"blur",this.blurInput.bind(this)),setTimeout(()=>XF.trigger(b,"blur"),100);else{console.warn("Switcher only works for text inputs, radios and selects.");
return}this.editor=a}else console.warn("Switcher container has no switcher: %o",this.target)},change(a){this.editor&&(a=this.switcher.querySelector("option:checked").value,this.switchLanguage(a))},blurInput(a){a=this.switcher.value;this.options.templateSuffixMode&&(a=a.toLowerCase(),a=a.includes(".less")?"less":a.includes(".css")?"css":"html");this.switchLanguage(a)},switchLanguage(a){if(!this.loading){var b=this.editor,c=b.getTextArea();b.save();c.dataset.lang!=a&&setTimeout(()=>{const d="public"==
e.querySelector("html").dataset.app;XF.ajax("post",XF.canonicalizeUrl(d?"index.php?misc/code-editor-mode-loader":"admin.php?templates/code-editor-mode-loader"),{language:a},this.handleAjax.bind(this)).finally(()=>{this.loading=!1})},200)}},handleAjax(a){if(!a.errors&&!a.exception){a.redirect&&XF.redirect(a.redirect);var b=this.editor,c=b.getTextArea();XF.setupHtmlInsert(a.html,(d,k)=>{d="";a.mime?d=a.mime:a.mode&&(d=a.mode);b.setOption("mode",d);c.dataset.lang=a.language;c.dataset.config=JSON.stringify(a.config);
a.config&&Object.entries(a.config).forEach(([f,g])=>{b.setOption(f,g)})})}}});XF.Element.register("code-editor","XF.CodeEditor");XF.Element.register("code-editor-switcher-container","XF.CodeEditorSwitcherContainer")})(window,document);
